<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PostMaster™ - Simulateur de contenu stratégique</title>
    <style>
        /* Reset et base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #F5F5F5;
            color: #071B47;
            line-height: 1.6;
        }

        /* Palette Covalt */
        :root {
            --orange-principal: #FF5A00;
            --bleu-nuit: #071B47;
            --fond-clair: #F5F5F5;
            --gris-neutre: #6B7280;
            --rouge-erreur: #DC2626;
            --blanc: #FFFFFF;
            --gris-clair: #E5E7EB;
        }

        /* Barre d'en-tête */
        .header {
            background: linear-gradient(135deg, var(--bleu-nuit) 0%, #0A2B5C 100%);
            box-shadow: 0 4px 24px rgba(7, 27, 71, 0.2);
            padding: 2rem 3rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 100;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 90, 0, 0.1) 0%, rgba(255, 90, 0, 0.05) 100%);
            transform: skewX(-20deg);
            transform-origin: top right;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            z-index: 2;
        }

        .logo {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--orange-principal) 0%, #FF7A33 50%, #FF9F66 100%);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 900;
            font-size: 24px;
            letter-spacing: -1px;
            box-shadow: 0 8px 24px rgba(255, 90, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .logo::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: rotate(45deg);
            animation: logoShine 3s ease-in-out infinite;
        }

        @keyframes logoShine {
            0%, 100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .header-brand {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .header-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--blanc);
            letter-spacing: -0.5px;
            line-height: 1;
        }

        .header-title .brand-post {
            color: var(--orange-principal);
        }

        .header-subtitle {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            z-index: 2;
        }

        .badge-version {
            background: rgba(255, 255, 255, 0.15);
            color: var(--blanc);
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.875rem;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .btn-aide {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: var(--blanc);
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .btn-aide:hover {
            border-color: var(--orange-principal);
            background: rgba(255, 90, 0, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(255, 90, 0, 0.3);
        }

        /* Modal d'aide/support */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--blanc);
            border-radius: 20px;
            padding: 2rem;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(7, 27, 71, 0.3);
            position: relative;
            animation: slideUp 0.3s ease;
            margin: 1rem;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--gris-clair);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--bleu-nuit);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-title-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--orange-principal), #FF7A33);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .btn-close-modal {
            background: var(--gris-clair);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--gris-neutre);
            font-size: 1.2rem;
        }

        .btn-close-modal:hover {
            background: var(--rouge-erreur);
            color: var(--blanc);
            transform: scale(1.1);
        }

        .help-section {
            margin-bottom: 2rem;
        }

        .help-section:last-child {
            margin-bottom: 0;
        }

        .help-section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--bleu-nuit);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .help-content {
            color: var(--gris-neutre);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .help-steps {
            list-style: none;
            padding: 0;
        }

        .help-steps li {
            background: var(--fond-clair);
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .help-steps li::before {
            content: counter(step-counter);
            counter-increment: step-counter;
            background: var(--orange-principal);
            color: var(--blanc);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .help-steps {
            counter-reset: step-counter;
        }

        .contact-info {
            background: linear-gradient(135deg, rgba(255, 90, 0, 0.05), rgba(255, 90, 0, 0.02));
            border: 1px solid rgba(255, 90, 0, 0.2);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
        }

        .contact-title {
            font-weight: 600;
            color: var(--orange-principal);
            margin-bottom: 0.5rem;
        }

        .contact-email {
            color: var(--bleu-nuit);
            font-weight: 500;
            text-decoration: none;
        }

        .contact-email:hover {
            text-decoration: underline;
        }

        /* Container principal */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Frise de progression */
        .frise-container {
            background: var(--blanc);
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(7, 27, 71, 0.06);
            padding: 2rem;
            margin-bottom: 2rem;
            overflow-x: auto;
        }

        .frise {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            min-width: 600px;
        }

        .frise-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            transition: transform 0.3s ease;
        }

        .frise-step:hover {
            transform: translateY(-2px);
        }

        .step-circle {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.125rem;
            font-variant-numeric: tabular-nums;
            transition: all 0.3s ease;
            position: relative;
        }

        /* États du cercle */
        .step-circle.active {
            background: linear-gradient(135deg, var(--orange-principal), #FF7A33);
            border: 3px solid var(--orange-principal);
            color: var(--blanc);
            animation: pulse-orange 2s infinite;
            box-shadow: 0 4px 16px rgba(255, 90, 0, 0.3);
        }

        .step-circle.completed {
            background: linear-gradient(135deg, var(--orange-principal), #FF7A33);
            border: 3px solid var(--orange-principal);
            color: var(--blanc);
            box-shadow: 0 4px 16px rgba(255, 90, 0, 0.2);
        }

        .step-circle.completed::after {
            content: '✓';
            position: absolute;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .step-circle.inactive {
            background: var(--blanc);
            border: 3px solid var(--gris-clair);
            color: var(--gris-neutre);
            transition: all 0.3s ease;
        }

        .step-circle.inactive:hover {
            border-color: rgba(255, 90, 0, 0.3);
            transform: scale(1.05);
        }

        .step-label {
            margin-top: 12px;
            font-size: 0.875rem;
            font-weight: 500;
            text-align: center;
            transition: color 0.3s ease;
        }

        .step-label.active {
            color: var(--bleu-nuit);
            font-weight: 600;
        }

        .step-label.completed {
            color: var(--orange-principal);
            font-weight: 600;
        }

        .step-label.inactive {
            color: var(--gris-neutre);
        }

        /* Ligne de progression */
        .frise::before {
            content: '';
            position: absolute;
            top: 28px;
            left: 28px;
            right: 28px;
            height: 4px;
            background: var(--gris-clair);
            border-radius: 2px;
            z-index: 1;
        }

        .frise::after {
            content: '';
            position: absolute;
            top: 28px;
            left: 28px;
            height: 4px;
            background: linear-gradient(90deg, var(--orange-principal), #FF7A33);
            border-radius: 2px;
            z-index: 1;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            width: calc((100% - 56px) * var(--progress-ratio, 0));
            box-shadow: 0 2px 8px rgba(255, 90, 0, 0.3);
        }

        /* Animation pulse */
        @keyframes pulse-orange {
            0%, 100% { 
                box-shadow: 0 4px 16px rgba(255, 90, 0, 0.3), 0 0 0 0 rgba(255, 90, 0, 0.4); 
            }
            50% { 
                box-shadow: 0 4px 16px rgba(255, 90, 0, 0.3), 0 0 0 8px rgba(255, 90, 0, 0); 
            }
        }

        /* Contenu des étapes */
        .step-content {
            background: var(--blanc);
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(7, 27, 71, 0.06);
            padding: 2.5rem;
            margin-bottom: 2rem;
            display: none;
        }

        .step-content.active {
            display: block;
            animation: fadeInUp 0.4s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--bleu-nuit);
            margin-bottom: 1rem;
        }

        .step-subtitle {
            font-size: 1.125rem;
            color: var(--gris-neutre);
            margin-bottom: 2rem;
        }

        /* Système de rappel des sélections */
        .selection-reminder {
            background: linear-gradient(135deg, rgba(255, 90, 0, 0.05), rgba(255, 90, 0, 0.02));
            border: 1px solid rgba(255, 90, 0, 0.15);
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 2rem;
            display: none;
        }

        .selection-reminder.show {
            display: block;
            animation: slideInDown 0.4s ease;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .reminder-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--orange-principal);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .reminder-selections {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .reminder-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--blanc);
            border: 1px solid rgba(255, 90, 0, 0.2);
            border-radius: 12px;
            padding: 8px 12px;
            transition: all 0.2s ease;
        }

        .reminder-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 90, 0, 0.15);
        }

        .reminder-icon {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: var(--blanc);
            flex-shrink: 0;
        }

        .reminder-icon svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }

        .reminder-text {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--bleu-nuit);
        }

        .reminder-separator {
            color: var(--gris-neutre);
            font-size: 0.875rem;
            font-weight: 400;
        }

        /* Classes spécifiques pour les icônes de plateforme dans le rappel */
        .reminder-icon.facebook { background: #1877F2; }
        .reminder-icon.instagram { background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D, #F56040, #F77737, #FCAF45, #FFDC80); }
        .reminder-icon.tiktok { background: #000000; }
        .reminder-icon.youtube { background: #FF0000; }
        .reminder-icon.linkedin { background: #0077B5; }
        .reminder-icon.twitter { background: #000000; }
        .reminder-icon.threads { background: #000000; }
        .reminder-icon.pinterest { background: #E60023; }

        /* Classes pour les icônes de format dans le rappel */
        .reminder-icon.publication { background: linear-gradient(135deg, var(--bleu-nuit), #0A2B5C); }
        .reminder-icon.carrousel { background: linear-gradient(135deg, var(--orange-principal), #FF7A33); }
        .reminder-icon.reel { background: linear-gradient(135deg, #DC2626, var(--rouge-erreur)); }
        .reminder-icon.story { background: linear-gradient(135deg, var(--orange-principal), #D97706); }
        .reminder-icon.video { background: linear-gradient(135deg, var(--bleu-nuit), #1F1F1F); }
        .reminder-icon.multi-sequences { background: linear-gradient(135deg, var(--orange-principal), #FF7A33); }
        .reminder-icon.short { background: linear-gradient(135deg, var(--rouge-erreur), #B91C1C); }
        .reminder-icon.document { background: linear-gradient(135deg, var(--bleu-nuit), #005885); }
        .reminder-icon.article { background: linear-gradient(135deg, var(--bleu-nuit), #005885); }
        .reminder-icon.tweet { background: linear-gradient(135deg, var(--gris-neutre), #4B5563); }
        .reminder-icon.thread { background: linear-gradient(135deg, var(--bleu-nuit), #111827); }
        .reminder-icon.epingle { background: linear-gradient(135deg, var(--rouge-erreur), #B8001A); }
        .reminder-icon.epingle-idee { background: linear-gradient(135deg, var(--orange-principal), #E60023); }

        /* Grille de cartes plateformes et formats */
        .platforms-grid, .formats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .formats-grid {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }

        .platform-card, .format-card {
            background: var(--blanc);
            border: 2px solid var(--gris-clair);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .platform-card:hover, .format-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 32px rgba(7, 27, 71, 0.12);
            border-color: var(--orange-principal);
        }

        .platform-card.selected, .format-card.selected {
            border-color: var(--orange-principal);
            background: linear-gradient(135deg, rgba(255, 90, 0, 0.05), rgba(255, 90, 0, 0.02));
        }

        .platform-card.selected::after, .format-card.selected::after {
            content: '✓';
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--orange-principal);
            color: var(--blanc);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .platform-logo, .format-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 1rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: var(--blanc);
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .platform-logo svg {
            width: 36px;
            height: 36px;
            fill: currentColor;
        }

        .format-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 1rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--blanc);
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .format-icon svg {
            width: 36px;
            height: 36px;
            fill: currentColor;
        }

        /* SVG Icons pour les formats */
        .format-icon .video-vertical-icon {
            width: 20px;
            height: 32px;
        }

        .format-icon .carrousel-icon {
            width: 32px;
            height: 24px;
        }

        .format-icon .story-icon {
            width: 28px;
            height: 36px;
        }

        .format-icon .post-image-icon {
            width: 32px;
            height: 32px;
        }

        .format-icon .post-text-icon {
            width: 28px;
            height: 32px;
        }

        .format-icon .thread-icon {
            width: 30px;
            height: 36px;
        }

        .format-icon .article-icon {
            width: 28px;
            height: 34px;
        }

        .format-icon .document-icon {
            width: 28px;
            height: 32px;
        }

        .format-icon .pinterest-icon {
            width: 30px;
            height: 32px;
        }

        .format-icon.publication {
            background: linear-gradient(135deg, var(--bleu-nuit), #0A2B5C);
        }

        .format-icon.carrousel {
            background: linear-gradient(135deg, var(--orange-principal), #FF7A33);
        }

        .format-icon.reel {
            background: linear-gradient(135deg, #DC2626, var(--rouge-erreur));
        }

        .format-icon.story {
            background: linear-gradient(135deg, var(--orange-principal), #D97706);
        }

        .format-icon.video {
            background: linear-gradient(135deg, var(--bleu-nuit), #1F1F1F);
        }

        .format-icon.multi-sequences {
            background: linear-gradient(135deg, var(--orange-principal), #FF7A33);
        }

        .format-icon.tiktok {
            background: linear-gradient(135deg, var(--bleu-nuit), #1F1F1F);
        }

        .format-icon.short {
            background: linear-gradient(135deg, var(--rouge-erreur), #B91C1C);
        }

        .format-icon.document {
            background: linear-gradient(135deg, var(--bleu-nuit), #005885);
        }

        .format-icon.article {
            background: linear-gradient(135deg, var(--bleu-nuit), #005885);
        }

        .format-icon.tweet {
            background: linear-gradient(135deg, var(--gris-neutre), #4B5563);
        }

        .format-icon.thread {
            background: linear-gradient(135deg, var(--bleu-nuit), #111827);
        }

        .format-icon.epingle {
            background: linear-gradient(135deg, var(--rouge-erreur), #B8001A);
        }

        .format-icon.epingle-idee {
            background: linear-gradient(135deg, var(--orange-principal), #E60023);
        }

        .platform-logo.facebook {
            background: #1877F2;
        }

        .platform-logo.threads {
            background: #000000;
        }

        .platform-logo.pinterest {
            background: #E60023;
        }

        .platform-logo.discord {
            background: #5865F2;
        }

        .platform-logo.instagram {
            background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D, #F56040, #F77737, #FCAF45, #FFDC80);
        }

        .platform-logo.tiktok {
            background: #000000;
        }

        .platform-logo.youtube {
            background: #FF0000;
        }

        .platform-logo.linkedin {
            background: #0077B5;
        }

        .platform-logo.twitter {
            background: #000000;
        }

        .platform-description {
            color: var(--gris-neutre);
            font-size: 0.875rem;
            line-height: 1.5;
            margin-bottom: 1rem;
            text-align: center;
            min-height: 46px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .format-description {
            color: var(--gris-neutre);
            font-size: 0.875rem;
            line-height: 1.5;
            margin-bottom: 1rem;
            text-align: center;
            min-height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .format-badges {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
            min-height: 32px;
            align-items: center;
        }

        .format-badge {
            padding: 6px 10px;
            border-radius: 14px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            white-space: nowrap;
        }

        .format-badge.type {
            background: linear-gradient(135deg, rgba(107, 114, 128, 0.1), rgba(107, 114, 128, 0.05));
            color: var(--gris-neutre);
            border: 1px solid rgba(107, 114, 128, 0.2);
        }

        .format-badge.requirement {
            background: linear-gradient(135deg, rgba(255, 90, 0, 0.1), rgba(255, 90, 0, 0.05));
            color: var(--orange-principal);
            border: 1px solid rgba(255, 90, 0, 0.2);
        }

        .platform-name, .format-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--bleu-nuit);
            margin-bottom: 0.5rem;
        }

        .platform-badges {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
            min-height: 32px;
            align-items: center;
        }

        .platform-badge {
            padding: 6px 10px;
            border-radius: 14px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            white-space: nowrap;
        }

        .platform-badge.users {
            background: linear-gradient(135deg, rgba(255, 90, 0, 0.1), rgba(255, 90, 0, 0.05));
            color: var(--orange-principal);
            border: 1px solid rgba(255, 90, 0, 0.2);
        }

        .platform-badge.category {
            background: linear-gradient(135deg, rgba(7, 27, 71, 0.1), rgba(7, 27, 71, 0.05));
            color: var(--bleu-nuit);
            border: 1px solid rgba(7, 27, 71, 0.2);
        }

        .format-specs {
            background: rgba(255, 90, 0, 0.08);
            border-radius: 8px;
            padding: 0.5rem;
            margin-top: 0.75rem;
            font-size: 0.75rem;
            color: var(--orange-principal);
            font-weight: 500;
        }

        /* Étape 3 - Création de contenu */
        .content-blocks {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .content-block {
            background: var(--blanc);
            border: 2px solid var(--gris-clair);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .content-block:focus-within {
            border-color: var(--orange-principal);
            box-shadow: 0 0 0 3px rgba(255, 90, 0, 0.1);
        }

        .content-block.global-field {
            background: linear-gradient(135deg, rgba(255, 90, 0, 0.03), rgba(255, 90, 0, 0.01));
            border: 2px solid rgba(255, 90, 0, 0.15);
        }

        .content-block.global-field .block-title {
            color: var(--orange-principal);
        }

        .block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .block-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--bleu-nuit);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .block-number {
            background: var(--orange-principal);
            color: var(--blanc);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-delete {
            background: var(--rouge-erreur);
            color: var(--blanc);
            border: none;
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-delete:hover {
            background: #B91C1C;
            transform: scale(1.05);
        }

        .textarea-container {
            position: relative;
            margin-bottom: 1rem;
        }

        .content-textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 2px solid var(--gris-clair);
            border-radius: 12px;
            font-family: inherit;
            font-size: 1rem;
            line-height: 1.5;
            color: var(--bleu-nuit);
            background: var(--blanc);
            resize: vertical;
            transition: all 0.2s ease;
        }

        .content-textarea:focus {
            outline: none;
            border-color: var(--orange-principal);
            box-shadow: 0 0 0 3px rgba(255, 90, 0, 0.1);
        }

        .content-textarea::placeholder {
            color: var(--gris-neutre);
        }

        .char-counter {
            position: absolute;
            bottom: 8px;
            right: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 12px;
            background: var(--blanc);
            transition: all 0.2s ease;
        }

        .char-counter.danger {
            color: var(--rouge-erreur);
            background: rgba(220, 38, 38, 0.1);
        }

        .char-counter.warning {
            color: var(--orange-principal);
            background: rgba(255, 90, 0, 0.1);
        }

        .char-counter.good {
            color: #059669;
            background: rgba(5, 150, 105, 0.1);
        }

        .char-counter.neutral {
            color: var(--gris-neutre);
            background: rgba(156, 163, 175, 0.1);
        }

        .optional-label {
            color: var(--gris-neutre);
            font-size: 0.875rem;
            font-style: italic;
            margin-left: 8px;
        }

        .btn-add-slide {
            background: transparent;
            border: 2px dashed var(--gris-clair);
            border-radius: 16px;
            padding: 2rem;
            width: 100%;
            color: var(--gris-neutre);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .btn-add-slide:hover {
            border-color: var(--orange-principal);
            color: var(--orange-principal);
            background: rgba(255, 90, 0, 0.02);
        }

        .validation-message {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #DC2626;
            padding: 1.25rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
            line-height: 1.5;
            display: none;
            position: relative;
        }

        .validation-message::before {
            content: "";
            margin-right: 0;
            font-size: 1rem;
        }

        .validation-message.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .content-tips {
            background: linear-gradient(135deg, rgba(255, 90, 0, 0.05), rgba(255, 90, 0, 0.02));
            border: 1px solid rgba(255, 90, 0, 0.2);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .tips-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--orange-principal);
            margin-bottom: 0.5rem;
        }

        .tips-list {
            font-size: 0.8rem;
            color: var(--gris-neutre);
            line-height: 1.4;
        }

        /* === ÉTAPE 4 - DESIGN VISUEL COMPLÈTEMENT REFAIT === */
        
        /* Container principal avec nouveau style */
        .visual-blocks-container {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 24px;
            padding: 2.5rem;
            margin: 2rem 0;
            border: 2px solid rgba(15, 23, 42, 0.08);
            box-shadow: 
                0 1px 3px rgba(15, 23, 42, 0.05),
                0 20px 40px rgba(15, 23, 42, 0.02);
        }

        /* Header redesigné */
        .visual-block-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2.5rem;
            padding: 2rem;
            background: linear-gradient(135deg, #1e40af 0%, #1d4ed8 100%);
            border-radius: 20px;
            color: white;
            box-shadow: 0 10px 30px rgba(30, 64, 175, 0.3);
        }

        .visual-icon {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            width: 64px;
            height: 64px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .visual-details h3 {
            color: white;
            font-size: 1.75rem;
            font-weight: 800;
            margin: 0 0 0.5rem 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .visual-requirements {
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.8);
            margin: 0;
            font-weight: 500;
        }

        .image-count {
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            padding: 1rem 1.5rem;
            font-size: 0.9rem;
            font-weight: 700;
            color: white;
            min-width: 120px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .image-count.complete {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        /* Zone d'upload redesignée */
        .upload-section {
            background: linear-gradient(135deg, white 0%, #fefefe 100%);
            border-radius: 20px;
            border: 3px dashed #e2e8f0;
            padding: 4rem 2rem;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 2.5rem;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .upload-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            transition: left 0.6s;
        }

        .upload-section:hover::before {
            left: 100%;
        }

        .upload-section:hover,
        .upload-section.dragover {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            transform: translateY(-4px);
            box-shadow: 
                0 20px 40px rgba(59, 130, 246, 0.15),
                0 0 0 1px rgba(59, 130, 246, 0.1);
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            color: #64748b;
            transition: all 0.4s ease;
            display: inline-block;
        }

        .upload-section:hover .upload-icon,
        .upload-section.dragover .upload-icon {
            color: #3b82f6;
            transform: scale(1.1) rotate(5deg);
        }

        .upload-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 0.75rem;
        }

        .upload-subtitle {
            color: #64748b;
            margin-bottom: 2rem;
            font-size: 1rem;
            font-weight: 500;
        }

        .btn-upload {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 16px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn-upload::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .btn-upload:hover::before {
            left: 100%;
        }

        .btn-upload:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.4);
        }

        /* Preview complètement refait avec hover zoom */
        .preview-main {
            background: white;
            border-radius: 20px;
            border: 2px solid #f1f5f9;
            overflow: hidden;
            margin-bottom: 2.5rem;
            box-shadow: 0 4px 16px rgba(15, 23, 42, 0.05);
        }

        .preview-header {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 1.5rem 2rem;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1e293b;
        }

        .preview-counter {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            padding: 2rem;
        }

        .preview-item {
            background: linear-gradient(135deg, #fefefe 0%, #f8fafc 100%);
            border-radius: 16px;
            padding: 1.5rem;
            position: relative;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid #f1f5f9;
            cursor: pointer;
            overflow: hidden;
        }

        .preview-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.03) 0%, rgba(37, 99, 235, 0.01) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .preview-item:hover::before {
            opacity: 1;
        }

        .preview-item:hover {
            border-color: #3b82f6;
            transform: translateY(-8px) scale(1.02);
            box-shadow: 
                0 20px 40px rgba(59, 130, 246, 0.15),
                0 0 0 1px rgba(59, 130, 246, 0.1);
        }

        .preview-thumbnail {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 1rem;
            transition: all 0.4s ease;
            cursor: pointer;
        }

        .preview-item:hover .preview-thumbnail {
            transform: scale(1.05);
            box-shadow: 0 8px 24px rgba(15, 23, 42, 0.15);
        }

        .preview-info {
            font-size: 0.85rem;
            color: #64748b;
            text-align: center;
            font-weight: 500;
        }

        .preview-remove {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
            z-index: 10;
        }

        .preview-remove:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
        }

        /* Modal d'aperçu en grand au hover */
        .preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .preview-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .preview-modal-content {
            max-width: 90vw;
            max-height: 90vh;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .preview-modal.show .preview-modal-content {
            transform: scale(1);
        }

        .preview-modal img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }

        .preview-modal-close {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .preview-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .image-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .image-number {
            background: var(--orange-principal);
            color: var(--blanc);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-remove-image {
            background: var(--rouge-erreur);
            color: var(--blanc);
            border: none;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-remove-image:hover {
            background: #B91C1C;
        }

        .image-placeholder {
            width: 100%;
            height: 120px;
            background: var(--fond-clair);
            border: 1px dashed var(--gris-clair);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gris-neutre);
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .image-info {
            font-size: 0.75rem;
            color: var(--gris-neutre);
            text-align: center;
        }

        .drag-handle {
            cursor: grab;
            color: var(--gris-neutre);
            font-size: 1rem;
            padding: 4px;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .upload-status {
            background: rgba(5, 150, 105, 0.1);
            border: 1px solid #059669;
            color: #059669;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
            display: none;
        }

        .upload-status.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .upload-status.error {
            background: rgba(220, 38, 38, 0.1);
            border-color: var(--rouge-erreur);
            color: var(--rouge-erreur);
        }

        .visual-validation-message {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #DC2626;
            padding: 1.25rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
            line-height: 1.5;
            display: none;
            position: relative;
        }

        .visual-validation-message::before {
            content: "";
            margin-right: 0;
            font-size: 1rem;
        }

        .visual-validation-message.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .skip-visual-section {
            background: rgba(107, 114, 128, 0.1);
            border: 1px solid var(--gris-neutre);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .skip-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--bleu-nuit);
            margin-bottom: 0.5rem;
        }

        .skip-description {
            font-size: 0.875rem;
            color: var(--gris-neutre);
            margin-bottom: 1rem;
        }

        .btn-skip-visual {
            background: transparent;
            border: 2px solid var(--gris-neutre);
            color: var(--gris-neutre);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-skip-visual:hover {
            border-color: var(--bleu-nuit);
            color: var(--bleu-nuit);
        }

        /* Étape 5 - Résumé et Analyse */
        .summary-section {
            margin-bottom: 2rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            background: var(--blanc);
            border: 2px solid var(--gris-clair);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            border-color: var(--orange-principal);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(7, 27, 71, 0.1);
        }

        .summary-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 1rem;
        }

        .summary-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--blanc);
            background: linear-gradient(135deg, var(--orange-principal), #FF7A33);
        }

        .summary-card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--bleu-nuit);
        }

        .summary-card-content {
            color: var(--gris-neutre);
            line-height: 1.5;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--gris-clair);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-weight: 500;
            color: var(--bleu-nuit);
        }

        .summary-value {
            color: var(--gris-neutre);
            text-align: right;
        }

        .content-preview {
            background: var(--fond-clair);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.875rem;
            line-height: 1.4;
            color: var(--gris-neutre);
        }

        .analyze-section {
            text-align: center;
            margin: 3rem 0;
        }

        .btn-analyze {
            background: linear-gradient(135deg, var(--orange-principal), #FF7A33);
            color: var(--blanc);
            border: none;
            padding: 20px 40px;
            border-radius: 16px;
            font-size: 1.25rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 24px rgba(255, 90, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn-analyze:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(255, 90, 0, 0.4);
        }

        .btn-analyze:active {
            transform: translateY(-2px);
        }

        .btn-analyze::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-analyze:hover::before {
            left: 100%;
        }

        .btn-analyze:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            pointer-events: none;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--blanc);
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .results-section {
            background: var(--blanc);
            border: 2px solid var(--gris-clair);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
            display: none;
        }

        .results-section.show {
            display: block;
            animation: fadeInUp 0.6s ease;
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--bleu-nuit);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .results-content {
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
            background: var(--fond-clair);
            border-radius: 12px;
            line-height: 1.6;
            color: var(--bleu-nuit);
        }

        .results-placeholder {
            color: var(--gris-neutre);
            font-style: italic;
            text-align: center;
            padding: 2rem;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-success {
            background: rgba(5, 150, 105, 0.1);
            color: #059669;
        }

        .badge-warning {
            background: rgba(255, 90, 0, 0.1);
            color: var(--orange-principal);
        }

        .badge-info {
            background: rgba(7, 27, 71, 0.1);
            color: var(--bleu-nuit);
        }

        .final-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .btn-restart {
            background: transparent;
            border: 2px solid var(--gris-clair);
            color: var(--bleu-nuit);
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-restart:hover {
            border-color: var(--bleu-nuit);
            background: var(--bleu-nuit);
            color: var(--blanc);
        }

        /* Navigation */
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-retour {
            background: transparent;
            border: 2px solid var(--gris-clair);
            color: var(--bleu-nuit);
        }

        .btn-retour:hover {
            border-color: var(--bleu-nuit);
            background: var(--bleu-nuit);
            color: var(--blanc);
        }

        .btn-suivant {
            background: var(--orange-principal);
            color: var(--blanc);
        }

        .btn-suivant:hover {
            background: #E54F00;
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(255, 90, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 1.5rem 1rem;
                flex-direction: column;
                gap: 1.5rem;
                text-align: center;
            }

            .header-left {
                flex-direction: column;
                text-align: center;
                gap: 16px;
            }

            .header-title {
                font-size: 1.5rem;
            }

            .header-subtitle {
                font-size: 0.8rem;
            }

            .container {
                padding: 1rem;
            }

            .frise-container {
                padding: 1rem;
            }

            .frise {
                min-width: 580px; /* Ajusté pour éviter le débordement à l'étape 4 */
            }

            .step-content {
                padding: 1.5rem;
            }

            .platforms-grid, .formats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .navigation {
                flex-direction: column-reverse;
                gap: 1rem;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .frise {
                min-width: 500px;
            }

            .step-circle {
                width: 48px;
                height: 48px;
                font-size: 1rem;
            }

            .step-label {
                font-size: 0.75rem;
            }

            .content-blocks {
                gap: 1rem;
            }

            .content-block {
                padding: 1rem;
            }

            .btn-add-slide {
                padding: 1.5rem 1rem;
                font-size: 0.875rem;
            }

            .dropzone {
                padding: 2rem 1rem;
            }

            .images-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 0.75rem;
            }

            .image-placeholder {
                height: 100px;
            }

            .summary-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .final-actions {
                flex-direction: column;
                align-items: center;
            }

            .btn-analyze {
                padding: 16px 32px;
                font-size: 1.125rem;
            }

            .modal-content {
                max-width: 95%;
                padding: 1.5rem;
                margin: 0.5rem;
                max-height: 90vh;
            }

            .modal-header {
                padding-bottom: 0.75rem;
                margin-bottom: 1rem;
            }

            .modal-title {
                font-size: 1.25rem;
            }

            .help-section {
                margin-bottom: 1.5rem;
            }

            .help-steps li {
                padding: 0.5rem;
                font-size: 0.875rem;
            }
        }

        /* ========== NOUVEAU SYSTÈME MODULAIRE VISUEL ========== */
        .modular-visual-block {
            background: var(--blanc);
            border-radius: 12px;
            border: 1px solid var(--gris-clair);
            box-shadow: 0 4px 16px rgba(7, 27, 71, 0.06);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .visual-block-header {
            background: linear-gradient(135deg, var(--bleu-nuit) 0%, #0A2B5C 100%);
            color: var(--blanc);
            padding: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .format-icon {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            flex-shrink: 0;
            margin-top: 0.25rem;
        }

        .format-icon svg {
            width: 28px;
            height: 28px;
            fill: var(--blanc);
        }

        .visual-requirements {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            flex: 1;
            min-width: 0;
        }

        .requirement-label {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .image-count, .dimensions, .formats {
            font-size: 0.9rem;
            opacity: 0.9;
            line-height: 1.4;
        }

        .upload-zone {
            padding: 2rem;
            transition: all 0.3s ease;
        }

        .upload-zone.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .upload-area {
            border: 2px dashed var(--gris-clair);
            border-radius: 12px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--fond-clair);
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: var(--orange-principal);
            background: rgba(255, 90, 0, 0.05);
            transform: translateY(-2px);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.7;
        }

        .upload-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--bleu-nuit);
            margin-bottom: 0.5rem;
        }

        .upload-subtitle {
            color: var(--gris-neutre);
            margin-bottom: 1.5rem;
        }

        .btn-upload {
            background: var(--orange-principal);
            color: var(--blanc);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-upload:hover {
            background: #E54900;
            transform: translateY(-1px);
        }

        .preview-container {
            margin: 2rem;
            border-top: 1px solid var(--gris-clair);
            padding-top: 2rem;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .preview-title {
            font-weight: 600;
            color: var(--bleu-nuit);
        }

        .preview-counter {
            background: var(--orange-principal);
            color: var(--blanc);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .preview-thumbnails {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .preview-item {
            background: var(--blanc);
            border: 2px solid var(--gris-clair);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: grab;
            position: relative;
        }

        .preview-item:hover {
            border-color: var(--orange-principal);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .preview-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
            cursor: grabbing;
        }

        .preview-item.drag-over {
            border-color: var(--bleu-principal);
            background: var(--bleu-clair);
        }

        .preview-thumbnail {
            width: 100%;
            height: 120px;
            object-fit: cover;
            cursor: pointer;
            transition: none;
        }

        .preview-info {
            padding: 0.75rem;
            background: var(--gris-tres-clair);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
        }

        .image-name {
            font-weight: 500;
            color: var(--gris-fonce);
            max-width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .image-order {
            background: var(--orange-principal);
            color: var(--blanc);
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .preview-controls {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--blanc);
        }

        .preview-move-btn {
            background: var(--bleu-principal);
            color: var(--blanc);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .preview-move-btn:hover {
            background: var(--bleu-fonce);
            transform: scale(1.1);
        }

        .preview-remove {
            background: var(--rouge);
            color: var(--blanc);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .preview-remove:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .preview-remove-section {
            padding: 0.5rem;
            display: flex;
            justify-content: center;
            background: var(--blanc);
            border-top: 1px solid var(--gris-clair);
        }

        .preview-remove-btn {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: var(--blanc);
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.2);
        }

        .preview-remove-btn:hover {
            background: linear-gradient(135deg, #b91c1c, #991b1b);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .preview-thumbnails {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 1rem;
            }
            
            .preview-thumbnail {
                height: 100px;
            }
            
            .preview-info {
                padding: 0.5rem;
                font-size: 0.7rem;
            }
        }

        .thumbnail {
            width: 100%;
            height: 70px;
            background: var(--gris-clair);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            gap: 0.5rem;
        }

        .thumbnail:hover, .thumbnail.active {
            border-color: var(--orange-principal);
            transform: translateX(4px);
        }

        .thumbnail img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .thumbnail-info {
            flex: 1;
            min-width: 0;
            font-size: 0.8rem;
            color: var(--gris-neutre);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .thumbnail-controls {
            display: flex;
            gap: 0.25rem;
        }

        .thumbnail-btn {
            width: 24px;
            height: 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            transition: all 0.3s ease;
        }

        .btn-move {
            background: var(--gris-clair);
            color: var(--gris-neutre);
        }

        .btn-move:hover {
            background: var(--orange-principal);
            color: var(--blanc);
        }

        .btn-remove {
            background: var(--rouge-erreur);
            color: var(--blanc);
        }

        .btn-remove:hover {
            background: #B91C1C;
        }

        .explanation-field {
            margin: 2rem;
            border-top: 1px solid var(--gris-clair);
            padding-top: 2rem;
        }

        .explanation-label {
            display: block;
            font-weight: 600;
            color: var(--bleu-nuit);
            margin-bottom: 0.5rem;
        }

        .explanation-textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 1px solid var(--gris-clair);
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95rem;
            line-height: 1.5;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .explanation-textarea:focus {
            outline: none;
            border-color: var(--orange-principal);
            box-shadow: 0 0 0 3px rgba(255, 90, 0, 0.1);
        }

        .skip-section {
            text-align: center;
            padding: 2rem;
            border-top: 1px solid var(--gris-clair);
        }

        .btn-skip-visual, .btn-add-visual {
            background: transparent;
            color: var(--gris-neutre);
            border: 1px solid var(--gris-clair);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-skip-visual:hover, .btn-add-visual:hover {
            border-color: var(--orange-principal);
            color: var(--orange-principal);
        }

        .no-visual-state {
            text-align: center;
            padding: 3rem 2rem;
            background: var(--fond-clair);
        }

        .no-visual-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .no-visual-text {
            color: var(--gris-neutre);
            margin-bottom: 1.5rem;
        }

        .upload-feedback {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: #10B981;
            color: var(--blanc);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);
            z-index: 1000;
            animation: slideInRight 0.3s ease;
        }

        .upload-feedback.error {
            background: var(--rouge-erreur);
            box-shadow: 0 8px 32px rgba(220, 38, 38, 0.3);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .visual-tips {
            background: rgba(255, 90, 0, 0.05);
            border-left: 4px solid var(--orange-principal);
            padding: 1rem;
            margin-bottom: 2rem;
            border-radius: 0 8px 8px 0;
            color: var(--bleu-nuit);
            font-style: italic;
        }

        /* Lightbox pour agrandissement */
        .image-lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .lightbox-content {
            position: relative;
            max-width: 90vw;
            max-height: 90vh;
        }

        .lightbox-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }

        .lightbox-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .lightbox-btn {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            color: var(--blanc);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .lightbox-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .lightbox-navigation {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: var(--blanc);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .lightbox-navigation:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        .lightbox-prev {
            left: 2rem;
        }

        .lightbox-next {
            right: 2rem;
        }

        /* Responsive pour le système modulaire */
        @media (max-width: 768px) {
            .modular-visual-block {
                margin-bottom: 1rem;
            }

            .visual-block-header {
                padding: 1rem;
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }

            .upload-area {
                padding: 2rem 1rem;
            }

            .preview-main {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .preview-thumbnails {
                flex-direction: row;
                max-height: none;
                overflow-x: auto;
            }

            .thumbnail {
                min-width: 120px;
                height: 80px;
            }

            .explanation-field, .preview-container {
                margin: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Barre d'en-tête -->
    <header class="header">
        <div class="header-left">
            <div class="logo">PM</div>
            <div class="header-brand">
                <h1 class="header-title"><span class="brand-post">Post</span>Master™</h1>
                <div class="header-subtitle">Simulateur de contenu stratégique</div>
            </div>
        </div>
        <div class="header-right">
            <span class="badge-version">v1.0</span>
            <button class="btn-aide" id="btn-support">💬 Aide</button>
        </div>
    </header>

    <!-- Container principal -->
    <div class="container">
        <!-- Frise de progression -->
        <div class="frise-container">
            <div class="frise" id="frise">
                <div class="frise-step">
                    <div class="step-circle active" id="circle-1">1</div>
                    <div class="step-label active">Plateforme</div>
                </div>
                <div class="frise-step">
                    <div class="step-circle inactive" id="circle-2">2</div>
                    <div class="step-label inactive">Format</div>
                </div>
                <div class="frise-step">
                    <div class="step-circle inactive" id="circle-3">3</div>
                    <div class="step-label inactive">Contenu</div>
                </div>
                <div class="frise-step">
                    <div class="step-circle inactive" id="circle-4">4</div>
                    <div class="step-label inactive">Visuel</div>
                </div>
                <div class="frise-step">
                    <div class="step-circle inactive" id="circle-5">5</div>
                    <div class="step-label inactive">Analyse</div>
                </div>
            </div>
        </div>

        <!-- ÉTAPE 1 - Choix de la plateforme -->
        <div class="step-content active" id="step-1">
            <h2 class="step-title">Choisissez votre plateforme</h2>
            <p class="step-subtitle">Sélectionnez la plateforme sur laquelle vous souhaitez publier votre contenu</p>
            
            <div class="platforms-grid">
                <!-- Facebook -->
                <div class="platform-card" data-platform="facebook">
                    <div class="platform-logo facebook">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                        </svg>
                    </div>
                    <h3 class="platform-name">Facebook</h3>
                    <p class="platform-description">Réseau social incontournable pour connecter des communautés</p>
                    <div class="platform-badges">
                        <span class="platform-badge users">3B+ utilisateurs</span>
                        <span class="platform-badge category">Communauté</span>
                    </div>
                </div>

                <!-- Instagram -->
                <div class="platform-card" data-platform="instagram">
                    <div class="platform-logo instagram">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                        </svg>
                    </div>
                    <h3 class="platform-name">Instagram</h3>
                    <p class="platform-description">Plateforme visuelle pour créer du contenu esthétique et inspirant</p>
                    <div class="platform-badges">
                        <span class="platform-badge users">2.1B+ utilisateurs</span>
                        <span class="platform-badge category">Créatif</span>
                    </div>
                </div>

                <!-- TikTok -->
                <div class="platform-card" data-platform="tiktok">
                    <div class="platform-logo tiktok">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
                        </svg>
                    </div>
                    <h3 class="platform-name">TikTok</h3>
                    <p class="platform-description">Réseau vidéo viral avec un algorithme ultra-performant et engageant</p>
                    <div class="platform-badges">
                        <span class="platform-badge users">1B+ utilisateurs</span>
                        <span class="platform-badge category">Viral</span>
                    </div>
                </div>

                <!-- YouTube -->
                <div class="platform-card" data-platform="youtube">
                    <div class="platform-logo youtube">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                        </svg>
                    </div>
                    <h3 class="platform-name">YouTube</h3>
                    <p class="platform-description">Référence mondiale pour du contenu éducatif, tutoriels et divertissement</p>
                    <div class="platform-badges">
                        <span class="platform-badge users">2.5B+ utilisateurs</span>
                        <span class="platform-badge category">Éducatif</span>
                    </div>
                </div>

                <!-- LinkedIn -->
                <div class="platform-card" data-platform="linkedin">
                    <div class="platform-logo linkedin">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                    </div>
                    <h3 class="platform-name">LinkedIn</h3>
                    <p class="platform-description">Réseau professionnel pour valoriser son expertise et ses opportunités</p>
                    <div class="platform-badges">
                        <span class="platform-badge users">310M+ utilisateurs</span>
                        <span class="platform-badge category">Professionnel</span>
                    </div>
                </div>

                <!-- X (Twitter) -->
                <div class="platform-card" data-platform="twitter">
                    <div class="platform-logo twitter">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                    </div>
                    <h3 class="platform-name">X (Twitter)</h3>
                    <p class="platform-description">Plateforme de micro‑blogging pour partager idées et actualités</p>
                    <div class="platform-badges">
                        <span class="platform-badge users">600M+ utilisateurs</span>
                        <span class="platform-badge category">Actualité</span>
                    </div>
                </div>

                <!-- Threads -->
                <div class="platform-card" data-platform="threads">
                    <div class="platform-logo threads">
                        <img src="threads.avif" alt="Threads" style="width: 70px; height: 70px; object-fit: contain;">
                    </div>
                    <h3 class="platform-name">Threads</h3>
                    <p class="platform-description">Plateforme Meta pour échanges publics et actualités sociales</p>
                    <div class="platform-badges">
                        <span class="platform-badge users">350M+ utilisateurs</span>
                        <span class="platform-badge category">Conversation</span>
                    </div>
                </div>

                <!-- Pinterest -->
                <div class="platform-card" data-platform="pinterest">
                    <div class="platform-logo pinterest">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.174-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.347-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.402.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.357-.629-2.746-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24.009 12.017 24c6.624 0 11.99-5.367 11.99-12C24.007 5.367 18.641.001.017 0z"/>
                        </svg>
                    </div>
                    <h3 class="platform-name">Pinterest</h3>
                    <p class="platform-description">Moteur de découverte visuel pour idées créatives et inspirations</p>
                    <div class="platform-badges">
                        <span class="platform-badge users">550M+ utilisateurs</span>
                        <span class="platform-badge category">Inspiration</span>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="navigation">
                <button class="btn btn-retour" disabled>← Retour</button>
                <button class="btn btn-suivant" id="btn-suivant-1" disabled>Suivant →</button>
            </div>
        </div>

        <!-- ÉTAPE 2 - Choix du format -->
        <div class="step-content" id="step-2">
            <h2 class="step-title">Choisissez votre format</h2>
            <p class="step-subtitle">Sélectionnez le type de contenu que vous souhaitez créer</p>
            
            <!-- Rappel de la plateforme sélectionnée -->
            <div class="selection-reminder" id="reminder-step-2">
                <div class="reminder-title">
                    📋 Vos sélections
                </div>
                <div class="reminder-selections">
                    <div class="reminder-item">
                        <div class="reminder-icon" id="reminder-platform-icon"></div>
                        <span class="reminder-text" id="reminder-platform-name">Plateforme</span>
                    </div>
                </div>
            </div>
            
            <div class="formats-grid" id="formats-container">
                <!-- Les formats seront générés dynamiquement selon la plateforme -->
            </div>

            <!-- Navigation -->
            <div class="navigation">
                <button class="btn btn-retour" id="btn-retour-2">← Retour</button>
                <button class="btn btn-suivant" id="btn-suivant-2" disabled>Suivant →</button>
            </div>
        </div>

        <!-- ÉTAPE 3 - Création du contenu -->
        <div class="step-content" id="step-3">
            <h2 class="step-title">Créez votre contenu</h2>
            <p class="step-subtitle" id="content-subtitle">Rédigez le contenu de votre publication</p>
            
            <!-- Rappel des sélections -->
            <div class="selection-reminder" id="reminder-step-3">
                <div class="reminder-title">
                    📋 Vos sélections
                </div>
                <div class="reminder-selections">
                    <div class="reminder-item">
                        <div class="reminder-icon" id="reminder-platform-icon-3"></div>
                        <span class="reminder-text" id="reminder-platform-name-3">Plateforme</span>
                    </div>
                    <span class="reminder-separator">→</span>
                    <div class="reminder-item">
                        <div class="reminder-icon" id="reminder-format-icon-3"></div>
                        <span class="reminder-text" id="reminder-format-name-3">Format</span>
                    </div>
                </div>
            </div>
            
            <!-- Message de validation -->
            <div class="validation-message" id="validation-message"></div>
            
            <!-- Conseils stratégiques -->
            <div class="content-tips" id="content-tips">
                <div class="tips-title">💡 Conseils stratégiques</div>
                <div class="tips-list" id="tips-content">
                    Commencez par un hook fort pour capter l'attention dès les premiers mots.
                </div>
            </div>
            
            <!-- Blocs de contenu -->
            <div class="content-blocks" id="content-blocks-container">
                <!-- Les blocs seront générés dynamiquement -->
            </div>
            
            <!-- Bouton ajouter slide (pour carrousel/thread) -->
            <button class="btn-add-slide" id="btn-add-slide" style="display: none;">
                <span>➕</span> Ajouter une slide
            </button>

            <!-- Navigation -->
            <div class="navigation">
                <button class="btn btn-retour" id="btn-retour-3">← Retour</button>
                <button class="btn btn-suivant" id="btn-suivant-3" disabled>Suivant →</button>
            </div>
        </div>

        <!-- ÉTAPE 4 - Upload des visuels -->
        <div class="step-content" id="step-4">
            <h2 class="step-title">Ajoutez vos visuels</h2>
            <p class="step-subtitle" id="visual-subtitle">Uploadez les images pour votre publication</p>
            
            <!-- Rappel des sélections -->
            <div class="selection-reminder" id="reminder-step-4">
                <div class="reminder-title">
                    📋 Vos sélections
                </div>
                <div class="reminder-selections">
                    <div class="reminder-item">
                        <div class="reminder-icon" id="reminder-platform-icon-4"></div>
                        <span class="reminder-text" id="reminder-platform-name-4">Plateforme</span>
                    </div>
                    <span class="reminder-separator">→</span>
                    <div class="reminder-item">
                        <div class="reminder-icon" id="reminder-format-icon-4"></div>
                        <span class="reminder-text" id="reminder-format-name-4">Format</span>
                    </div>
                </div>
            </div>
            
            <!-- Message de validation -->
            <div class="visual-validation-message" id="visual-validation-message"></div>
            
            <!-- Conseils pour ce format -->
            <div class="visual-tips" id="tips-visual">
                Ajoutez des visuels adaptés à votre format pour maximiser l'engagement
            </div>
            
            <!-- Container pour le système modulaire -->
            <div class="visual-blocks-container" id="visual-blocks-container">
                <!-- Le bloc visuel modulaire sera généré ici -->
            </div>

            <!-- Navigation -->
            <div class="navigation">
                <button class="btn btn-retour" id="btn-retour-4">← Retour</button>
                <button class="btn btn-suivant" id="btn-suivant-4" disabled>Suivant →</button>
            </div>
        </div>

        <!-- ÉTAPE 5 - Résumé et Analyse -->
        <div class="step-content" id="step-5">
            <h2 class="step-title">Résumé de votre contenu</h2>
            <p class="step-subtitle">Vérifiez tous les détails avant l'analyse stratégique</p>
            
            <!-- Rappel des sélections -->
            <div class="selection-reminder" id="reminder-step-5">
                <div class="reminder-title">
                    📋 Vos sélections
                </div>
                <div class="reminder-selections">
                    <div class="reminder-item">
                        <div class="reminder-icon" id="reminder-platform-icon-5"></div>
                        <span class="reminder-text" id="reminder-platform-name-5">Plateforme</span>
                    </div>
                    <span class="reminder-separator">→</span>
                    <div class="reminder-item">
                        <div class="reminder-icon" id="reminder-format-icon-5"></div>
                        <span class="reminder-text" id="reminder-format-name-5">Format</span>
                    </div>
                </div>
            </div>
            
            <!-- Grille de résumé -->
            <div class="summary-grid">
                <!-- Carte Plateforme et Format -->
                <div class="summary-card">
                    <div class="summary-card-header">
                        <div class="summary-icon">🎯</div>
                        <h3 class="summary-card-title">Configuration</h3>
                    </div>
                    <div class="summary-card-content">
                        <div class="summary-item">
                            <span class="summary-label">Plateforme :</span>
                            <span class="summary-value" id="summary-platform">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Format :</span>
                            <span class="summary-value" id="summary-format">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Type :</span>
                            <span class="summary-value" id="summary-type">-</span>
                        </div>
                    </div>
                </div>

                <!-- Carte Contenu -->
                <div class="summary-card">
                    <div class="summary-card-header">
                        <div class="summary-icon">📝</div>
                        <h3 class="summary-card-title">Contenu créé</h3>
                    </div>
                    <div class="summary-card-content">
                        <div class="summary-item">
                            <span class="summary-label">Nombre de blocs :</span>
                            <span class="summary-value" id="summary-blocks-count">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Total caractères :</span>
                            <span class="summary-value" id="summary-total-chars">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Statut :</span>
                            <span class="summary-value" id="summary-content-status">-</span>
                        </div>
                        <div class="content-preview" id="content-preview">
                            Aperçu du contenu...
                        </div>
                    </div>
                </div>

                <!-- Carte Visuels -->
                <div class="summary-card">
                    <div class="summary-card-header">
                        <div class="summary-icon">🖼️</div>
                        <h3 class="summary-card-title">Éléments visuels</h3>
                    </div>
                    <div class="summary-card-content">
                        <div class="summary-item">
                            <span class="summary-label">Images uploadées :</span>
                            <span class="summary-value" id="summary-images-count">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Requis :</span>
                            <span class="summary-value" id="summary-images-required">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Statut :</span>
                            <span class="summary-value" id="summary-visual-status">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section d'analyse -->
            <div class="analyze-section">
                <button class="btn-analyze" id="btn-analyze-post">
                    <span id="analyze-text">🚀 Analyser mon post</span>
                </button>
                <p style="margin-top: 1rem; color: var(--gris-neutre); font-size: 0.875rem;">
                    Notre IA analysera votre contenu et vous donnera des recommandations stratégiques personnalisées
                </p>
            </div>

            <!-- Section des résultats -->
            <div class="results-section" id="results-section">
                <h3 class="results-title">📊 Analyse stratégique de votre contenu</h3>
                <div class="results-content" id="results-content">
                    <div class="results-placeholder">
                        L'analyse apparaîtra ici...
                    </div>
                </div>
            </div>

            <!-- Actions finales -->
            <div class="final-actions">
                <button class="btn-restart" id="btn-restart">🔄 Créer un nouveau post</button>
            </div>

            <!-- Navigation -->
            <div class="navigation">
                <button class="btn btn-retour" id="btn-retour-5">← Retour</button>
                <span style="color: var(--gris-neutre); font-style: italic;">Dernière étape</span>
            </div>
        </div>
    </div>

    <!-- Modal d'aide/support -->
    <div class="modal-overlay" id="modal-support">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <div class="modal-title-icon">🧠</div>
                    Centre d'aide PostMaster™
                </div>
                <button class="btn-close-modal" id="btn-close-modal">×</button>
            </div>

            <div class="help-section">
                <h3 class="help-section-title">✅ À quoi sert PostMaster™ ?</h3>
                <div class="help-content">
                    PostMaster™ est votre assistant intelligent pour créer des contenus sociaux plus performants. Même si vous êtes déjà un bon créateur, notre simulateur vous aide à identifier les détails qui font la différence : clarté du message, qualité visuelle, appel à l'action... Chaque post est analysé selon plus de 100 critères pour maximiser son impact avant publication.
                </div>
            </div>

            <div class="help-section">
                <h3 class="help-section-title">🧭 Comment ça fonctionne ?</h3>
                <div class="help-content">
                    Le processus est simple et guidé : d'abord, vous sélectionnez votre plateforme cible (Instagram, TikTok, LinkedIn...). Puis vous choisissez le format de votre contenu (carrousel, vidéo, post simple...). Ensuite, vous rédigez votre texte et ajoutez votre visuel principal. Notre double IA (GPT-4 pour le texte, Google Vision pour l'image) analyse alors chaque élément selon nos critères d'optimisation. Enfin, vous recevez un score détaillé avec des conseils personnalisés pour améliorer votre contenu.
                </div>
            </div>

            <div class="help-section">
                <h3 class="help-section-title">✍️ Que dois-je écrire ou ajouter ?</h3>
                <div class="help-content">
                    <strong>Pour le texte :</strong> Rédigez votre contenu principal (légende, description) comme vous le feriez normalement. Minimum recommandé de 50 caractères pour une analyse pertinente.
                    <br><br>
                    <strong>Pour le visuel :</strong> Ajoutez l'image finale de votre post (première slide pour un carrousel, cover pour une vidéo). Formats acceptés : JPG, PNG, WebP.
                    <br><br>
                    <strong>Pour les carrousels :</strong> Ajoutez chaque slide dans l'ordre de publication pour une analyse complète de votre storytelling visuel.
                </div>
            </div>

            <div class="help-section">
                <h3 class="help-section-title">🧠 Comment l'IA note mon post ?</h3>
                <div class="help-content">
                    L'analyse repose sur plus de 100 critères binaires (oui/non) répartis en 10 catégories clés : clarté du message, structure du contenu, design visuel, lisibilité, appel à l'action, engagement potentiel, adaptation à la plateforme, qualité technique, cohérence globale et originalité. Plus votre contenu valide de critères, plus votre score est élevé. Le système est conçu pour identifier précisément ce qui peut être optimisé dans votre création.
                </div>
            </div>

            <div class="help-section">
                <h3 class="help-section-title">🎯 Comment m'améliorer concrètement ?</h3>
                <div class="help-content">
                    Chaque analyse génère des conseils précis et actionnables : reformulations suggérées, modifications visuelles spécifiques, ajouts de call-to-action, amélioration de la clarté du message... Ces recommandations sont pensées pour être appliquées immédiatement. Prenez quelques minutes pour les lire avant de publier : c'est là que se joue la différence entre un bon post et un post exceptionnel.
                </div>
            </div>

            <div class="help-section">
                <h3 class="help-section-title">🚨 Et si ma note est basse ?</h3>
                <div class="help-content">
                    Une note basse ne signifie pas que votre post est mauvais ! Cela indique simplement qu'il a un fort potentiel d'amélioration. L'objectif n'est pas d'obtenir 100/100 dès la première tentative, mais de progresser étape par étape. N'hésitez pas à modifier votre contenu selon nos suggestions, puis à le re-analyser pour voir l'évolution de votre score.
                </div>
            </div>

            <div class="help-section">
                <h3 class="help-section-title">💡 Astuces pour des posts plus performants</h3>
                <div class="help-content">
                    <ol class="help-steps">
                        <li>Créez une accroche forte dans les 3 premières lignes pour capter l'attention</li>
                        <li>Utilisez des verbes d'action pour dynamiser votre message</li>
                        <li>Assurez-vous que votre visuel reste lisible même sur mobile</li>
                        <li>Concentrez-vous sur un seul message clair par post</li>
                        <li>Intégrez un appel à l'action visible et engageant</li>
                    </ol>
                </div>
            </div>

            <div class="help-section">
                <h3 class="help-section-title">❓ Besoin d'aide personnalisée ?</h3>
                <div class="help-content">
                    Pour aller plus loin dans l'optimisation de vos contenus, explorez l'écosystème Covalt : simulateurs intelligents, ebooks stratégiques, outils d'analyse avancés. Chaque ressource a été conçue pour vous aider à créer des publications plus claires, plus engageantes et plus performantes.
                    <br><br>
                    Créez votre compte gratuit pour débloquer vos premières ressources et améliorer concrètement vos résultats.
                </div>
            </div>

            <div class="help-section">
                <div class="contact-info">
                    <div class="contact-title">Besoin d'aide supplémentaire ?</div>
                    <div>Contactez notre équipe support :</div>
                    <a href="mailto:contact@usecovalt.com" class="contact-email">contact@usecovalt.com</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let currentStep = 1;
        let selectedPlatform = null;
        let selectedFormat = null;
        let contentData = {};
        let visualData = { images: [], required: false };

        // Gestion de la modal de support
        function initSupportModal() {
            const btnSupport = document.getElementById('btn-support');
            const modalSupport = document.getElementById('modal-support');
            const btnCloseModal = document.getElementById('btn-close-modal');

            // Ouvrir la modal
            btnSupport.addEventListener('click', function() {
                modalSupport.classList.add('show');
                document.body.style.overflow = 'hidden'; // Empêcher le scroll
            });

            // Fermer la modal
            function closeModal() {
                modalSupport.classList.remove('show');
                document.body.style.overflow = 'auto'; // Rétablir le scroll
            }

            btnCloseModal.addEventListener('click', closeModal);

            // Fermer en cliquant sur l'overlay
            modalSupport.addEventListener('click', function(e) {
                if (e.target === modalSupport) {
                    closeModal();
                }
            });

            // Fermer avec la touche Échap
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modalSupport.classList.contains('show')) {
                    closeModal();
                }
            });
        }

        // Configuration des formats par plateforme avec mapping et badges
        const platformFormats = {
            instagram: [
                { 
                    id: 'publication', 
                    name: 'Publication', 
                    description: 'Post classique optimisé pour l\'engagement et la découverte via hashtags',
                    badges: ['ENGAGEMENT', 'FEED PRINCIPAL'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="6" width="14" height="10" rx="2" fill="currentColor"/><rect x="6" y="8" width="5" height="4" rx="1" fill="white"/><rect x="12" y="8" width="6" height="1" rx="0.5" fill="white"/><rect x="12" y="10" width="4" height="0.8" rx="0.4" fill="white" opacity="0.8"/><rect x="12" y="11.5" width="5" height="0.8" rx="0.4" fill="white" opacity="0.6"/></svg>',
                    iconClass: 'publication'
                },
                { 
                    id: 'story', 
                    name: 'Story', 
                    description: 'Idéal pour montrer les coulisses et créer de la proximité',
                    badges: ['PROXIMITÉ', '24H ONLY'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="9" y="4" width="6" height="16" rx="2" fill="currentColor"/><circle cx="12" cy="12" r="8" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3"/><path d="M16 8 L17.5 9.5 M16 16 L17.5 14.5" stroke="white" stroke-width="1" fill="none"/></svg>',
                    iconClass: 'story'
                },
                { 
                    id: 'carrousel', 
                    name: 'Carrousel', 
                    description: 'Format storytelling puissant qui retient l\'attention plus longtemps',
                    badges: ['STORYTELLING', 'JUSQU\'À 10'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="7" width="5" height="8" rx="1" fill="currentColor" opacity="0.3"/><rect x="7" y="8" width="5" height="8" rx="1" fill="currentColor" opacity="0.6"/><rect x="10" y="9" width="5" height="8" rx="1" fill="white"/><circle cx="18" cy="10" r="0.8" fill="white"/><circle cx="18" cy="12" r="0.6" fill="white" opacity="0.7"/><circle cx="18" cy="14" r="0.6" fill="white" opacity="0.5"/></svg>',
                    iconClass: 'carrousel'
                },
                { 
                    id: 'reel', 
                    name: 'Reel', 
                    description: 'Format viral n°1 avec portée organique maximale',
                    badges: ['VIRAL', '15-90S'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="8" y="3" width="8" height="18" rx="2" fill="currentColor"/><rect x="9" y="4" width="6" height="16" rx="1" fill="white"/><circle cx="12" cy="12" r="2.5" fill="none" stroke="currentColor" stroke-width="1.5"/><polygon points="11,10.5 11,13.5 13,12" fill="currentColor"/></svg>',
                    iconClass: 'reel'
                }
            ],
            tiktok: [
                { 
                    id: 'video', 
                    name: 'Vidéo classique', 
                    description: 'Algorithme ultra-performant qui récompense la créativité authentique',
                    badges: ['CRÉATIVITÉ', 'MAX 3MIN'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="8" y="3" width="8" height="18" rx="2" fill="currentColor"/><rect x="9" y="4" width="6" height="16" rx="1" fill="white"/><circle cx="12" cy="12" r="2.5" fill="none" stroke="currentColor" stroke-width="1.5"/><polygon points="11,10.5 11,13.5 13,12" fill="currentColor"/></svg>',
                    iconClass: 'video'
                },
                { 
                    id: 'multi-sequences', 
                    name: 'Multi-séquences', 
                    description: 'Format natif pour dérouler plusieurs visuels comme un mini-diaporama',
                    badges: ['VISUELS MULTIPLES', 'NARRATIF'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="7" width="5" height="8" rx="1" fill="currentColor" opacity="0.3"/><rect x="7" y="8" width="5" height="8" rx="1" fill="currentColor" opacity="0.6"/><rect x="10" y="9" width="5" height="8" rx="1" fill="white"/><circle cx="18" cy="10" r="0.8" fill="white"/><circle cx="18" cy="12" r="0.6" fill="white" opacity="0.7"/><circle cx="18" cy="14" r="0.6" fill="white" opacity="0.5"/></svg>',
                    iconClass: 'carrousel'
                }
            ],
            youtube: [
                { 
                    id: 'short', 
                    name: 'Short', 
                    description: 'Concurrence TikTok avec monétisation rapide et découverte massive',
                    badges: ['MONÉTISATION', 'MAX 60S'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="8" y="3" width="8" height="18" rx="2" fill="currentColor"/><rect x="9" y="4" width="6" height="16" rx="1" fill="white"/><circle cx="12" cy="12" r="2.5" fill="none" stroke="currentColor" stroke-width="1.5"/><polygon points="11,10.5 11,13.5 13,12" fill="currentColor"/></svg>',
                    iconClass: 'short'
                }
            ],
            linkedin: [
                { 
                    id: 'publication', 
                    name: 'Publication', 
                    description: 'Post texte ou visuel pour booster sa crédibilité professionnelle',
                    badges: ['EXPERTISE', 'RÉSEAU PRO'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="5" width="12" height="14" rx="2" fill="currentColor"/><circle cx="9" cy="9" r="1.2" fill="white"/><rect x="11" y="8" width="6" height="1" rx="0.5" fill="white"/><rect x="11" y="10" width="4" height="0.8" rx="0.4" fill="white" opacity="0.8"/><rect x="7" y="12" width="10" height="0.8" rx="0.4" fill="white" opacity="0.6"/><rect x="7" y="14" width="8" height="0.8" rx="0.4" fill="white" opacity="0.5"/><rect x="7" y="16" width="6" height="0.8" rx="0.4" fill="white" opacity="0.4"/></svg>',
                    iconClass: 'publication'
                },
                { 
                    id: 'document', 
                    name: 'Document PDF', 
                    description: 'Format carrousel PDF pour présenter données, slides ou analyses',
                    badges: ['DONNÉES', 'PDF/SLIDES'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="7" width="5" height="8" rx="1" fill="currentColor" opacity="0.3"/><rect x="7" y="8" width="5" height="8" rx="1" fill="currentColor" opacity="0.6"/><rect x="10" y="9" width="5" height="8" rx="1" fill="white"/><circle cx="18" cy="10" r="0.8" fill="white"/><circle cx="18" cy="12" r="0.6" fill="white" opacity="0.7"/><circle cx="18" cy="14" r="0.6" fill="white" opacity="0.5"/></svg>',
                    iconClass: 'document'
                },
                { 
                    id: 'article', 
                    name: 'Article LinkedIn', 
                    description: 'Long format pour développer une idée, raconter un parcours ou structurer une analyse',
                    badges: ['PROFONDEUR', 'LONG FORMAT'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="3" width="14" height="18" rx="2" fill="currentColor"/><path d="M17 3 L19 5 L19 7 L17 7 Z" fill="white"/><rect x="7" y="7" width="10" height="1.5" rx="0.5" fill="white"/><rect x="7" y="9.5" width="8" height="1" rx="0.5" fill="white" opacity="0.8"/><rect x="7" y="11.5" width="9" height="1" rx="0.5" fill="white" opacity="0.6"/><rect x="7" y="13.5" width="7" height="1" rx="0.5" fill="white" opacity="0.5"/><rect x="7" y="15.5" width="6" height="1" rx="0.5" fill="white" opacity="0.4"/><path d="M14 18 L15 19 L17 17" stroke="white" stroke-width="1.2" fill="none"/></svg>',
                    iconClass: 'document'
                }
            ],
            facebook: [
                { 
                    id: 'publication', 
                    name: 'Publication', 
                    description: 'Format polyvalent pour partager des actus et engager sa communauté',
                    badges: ['COMMUNAUTÉ', 'MULTI-FORMAT'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="6" width="14" height="10" rx="2" fill="currentColor"/><rect x="6" y="8" width="5" height="4" rx="1" fill="white"/><rect x="12" y="8" width="6" height="1" rx="0.5" fill="white"/><rect x="12" y="10" width="4" height="0.8" rx="0.4" fill="white" opacity="0.8"/><rect x="12" y="11.5" width="5" height="0.8" rx="0.4" fill="white" opacity="0.6"/></svg>',
                    iconClass: 'publication'
                },
                { 
                    id: 'story', 
                    name: 'Story', 
                    description: 'Contenu éphémère 24h pour partager des moments spontanés',
                    badges: ['ÉPHÉMÈRE', '24H'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="9" y="4" width="6" height="16" rx="2" fill="currentColor"/><circle cx="12" cy="12" r="8" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3"/><path d="M16 8 L17.5 9.5 M16 16 L17.5 14.5" stroke="white" stroke-width="1" fill="none"/></svg>',
                    iconClass: 'story'
                },
                { 
                    id: 'reel', 
                    name: 'Reel', 
                    description: 'Vidéo courte verticale pour toucher un large public',
                    badges: ['VIDÉO', 'COURTE VIRALITÉ'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="8" y="3" width="8" height="18" rx="2" fill="currentColor"/><rect x="9" y="4" width="6" height="16" rx="1" fill="white"/><circle cx="12" cy="12" r="2.5" fill="none" stroke="currentColor" stroke-width="1.5"/><polygon points="11,10.5 11,13.5 13,12" fill="currentColor"/></svg>',
                    iconClass: 'reel'
                }
            ],
            twitter: [
                { 
                    id: 'tweet', 
                    name: 'Tweet', 
                    description: 'Messages percutants dans l\'actualité en temps réel',
                    badges: ['TEMPS RÉEL', '280 CARACTÈRES'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="5" width="12" height="14" rx="2" fill="currentColor"/><circle cx="9" cy="9" r="1.2" fill="white"/><rect x="11" y="8" width="6" height="1" rx="0.5" fill="white"/><rect x="11" y="10" width="4" height="0.8" rx="0.4" fill="white" opacity="0.8"/><rect x="7" y="12" width="10" height="0.8" rx="0.4" fill="white" opacity="0.6"/><rect x="7" y="14" width="8" height="0.8" rx="0.4" fill="white" opacity="0.5"/><rect x="7" y="16" width="6" height="0.8" rx="0.4" fill="white" opacity="0.4"/></svg>',
                    iconClass: 'tweet'
                },
                { 
                    id: 'thread', 
                    name: 'Thread', 
                    description: 'Développez vos idées complexes en gardant l\'attention captive',
                    badges: ['RÉFLEXION', 'MULTI-TWEET'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="5" width="6" height="4" rx="1.5" fill="currentColor" opacity="0.4"/><rect x="6" y="9" width="8" height="5" rx="1.5" fill="currentColor" opacity="0.7"/><rect x="8" y="13" width="10" height="6" rx="1.5" fill="white"/><line x1="8" y1="9" x2="9" y2="10" stroke="white" stroke-width="1.2"/><line x1="11" y1="13" x2="12" y2="14" stroke="white" stroke-width="1.2"/></svg>',
                    iconClass: 'thread'
                }
            ],
            threads: [
                { 
                    id: 'thread', 
                    name: 'Thread', 
                    description: 'Alternative Meta à Twitter pour conversations authentiques',
                    badges: ['CONVERSATION', 'META ECO'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="5" width="6" height="4" rx="1.5" fill="currentColor" opacity="0.4"/><rect x="6" y="9" width="8" height="5" rx="1.5" fill="currentColor" opacity="0.7"/><rect x="8" y="13" width="10" height="6" rx="1.5" fill="white"/><line x1="8" y1="9" x2="9" y2="10" stroke="white" stroke-width="1.2"/><line x1="11" y1="13" x2="12" y2="14" stroke="white" stroke-width="1.2"/></svg>',
                    iconClass: 'thread'
                }
            ],
            pinterest: [
                { 
                    id: 'epingle', 
                    name: 'Épingle', 
                    description: 'Moteur de recherche visuel avec trafic qualifié vers ton site',
                    badges: ['SEO VISUEL', 'VERTICAL 2:3'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="7" y="3" width="10" height="18" rx="3" fill="currentColor"/><rect x="8" y="5" width="8" height="12" rx="2" fill="white"/><circle cx="12" cy="11" r="1.5" fill="currentColor"/><path d="M10.2 11 L11.5 12.3 L13.8 10" stroke="white" stroke-width="1" fill="none"/></svg>',
                    iconClass: 'epingle'
                },
                { 
                    id: 'epingle-idee', 
                    name: 'Épingle idée', 
                    description: 'Format tutoriel ou guide étape par étape',
                    badges: ['TUTORIAL', 'JUSQU\'À 5'],
                    iconHtml: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="7" width="5" height="8" rx="1" fill="currentColor" opacity="0.3"/><rect x="7" y="8" width="5" height="8" rx="1" fill="currentColor" opacity="0.6"/><rect x="10" y="9" width="5" height="8" rx="1" fill="white"/><circle cx="18" cy="10" r="0.8" fill="white"/><circle cx="18" cy="12" r="0.6" fill="white" opacity="0.7"/><circle cx="18" cy="14" r="0.6" fill="white" opacity="0.5"/></svg>',
                    iconClass: 'epingle-idee'
                }
            ]
        };

        // Configuration des blocs de contenu par format
        const contentConfig = {
            // === FORMATS VIDÉO ===
            'reel': {
                blocks: [
                    { type: 'main', title: 'Texte sur le Reel', placeholder: 'Texte affiché sur votre Reel (mots-clés, titre, etc.)...', required: true, min: 20, max: 300 },
                    { type: 'caption', title: 'Légende', placeholder: 'Légende de votre Reel...', required: true, min: 50, max: 2200 }
                ],
                tips: 'Reel : Texte accrocheur sur la vidéo + légende engageante avec hashtags.'
            },
            'video': {
                blocks: [
                    { type: 'main', title: 'Texte sur la vidéo', placeholder: 'Texte affiché sur votre vidéo TikTok...', required: true, min: 20, max: 150 },
                    { type: 'caption', title: 'Légende', placeholder: 'Description de votre vidéo...', required: true, min: 50, max: 2200 }
                ],
                tips: 'TikTok : Texte court et percutant sur la vidéo + description engageante.'
            },
            'short': {
                blocks: [
                    { type: 'title', title: 'Titre', placeholder: 'Titre accrocheur de votre Short...', required: true, min: 20, max: 100 },
                    { type: 'main', title: 'Texte sur le Short', placeholder: 'Texte affiché sur votre YouTube Short...', required: true, min: 20, max: 200 },
                    { type: 'caption', title: 'Description', placeholder: 'Description de votre Short...', required: true, min: 50, max: 2200 }
                ],
                tips: 'YouTube Short : Titre accrocheur + description optimisée SEO.'
            },

            // === FORMATS STORY ===
            'story': {
                blocks: [
                    { type: 'main', title: 'Contenu de la Story', placeholder: 'Texte, stickers, interactions de votre Story...', required: true, min: 20, max: 500 }
                ],
                tips: 'Stories éphémères : contenu authentique, interactions (sondages, questions), call-to-action en swipe up.'
            },

            // === FORMATS PUBLICATION CLASSIQUE ===
            'publication': {
                blocks: [
                    { type: 'main', title: 'Contenu principal', placeholder: 'Rédigez le contenu de votre publication...', required: true, min: 20, max: 2200 },
                    { type: 'caption', title: 'Légende', placeholder: 'Légende complémentaire...', required: true, min: 50, max: 2200 }
                ],
                tips: 'Utilisez des émojis, posez des questions et incluez des hashtags pertinents pour maximiser l\'engagement.'
            },

            // === FORMATS TEXTE SEUL ===
            'tweet': {
                blocks: [
                    { type: 'main', title: 'Contenu du Tweet', placeholder: 'Rédigez votre tweet...', required: true, min: 20, max: 280 }
                ],
                tips: 'Soyez concis, utilisez des hashtags stratégiques, mentionnez des comptes pertinents.'
            },

            // === FORMATS MULTI-BLOCS ===
            'carrousel': {
                multiBlock: true,
                minBlocks: 2,
                maxBlocks: 10,
                globalFields: {
                    caption: { title: 'Légende générale', placeholder: 'Légende commune à tout le carrousel...', required: true, min: 50, max: 2200 }
                },
                blockTemplate: {
                    main: { title: 'Contenu de la slide', placeholder: 'Texte/contenu de cette slide ou cochez "Pas de texte" si slide visuelle uniquement...', required: false, min: 0, max: 300, allowEmpty: true }
                },
                tips: 'Chaque slide doit avoir un message clair. Utilisez la dernière slide pour un call-to-action efficace.'
            },
            'multi-sequences': {
                multiBlock: true,
                minBlocks: 2,
                maxBlocks: 10,
                globalFields: {
                    caption: { title: 'Description générale', placeholder: 'Description de votre séquence TikTok...', required: true, min: 50, max: 2200 }
                },
                blockTemplate: {
                    main: { title: 'Texte de la séquence', placeholder: 'Texte affiché sur cette séquence ou cochez "Pas de texte" si séquence visuelle uniquement...', required: false, min: 0, max: 150, allowEmpty: true }
                },
                tips: 'Format multi-séquences TikTok : chaque séquence doit créer du suspense pour garder l\'attention.'
            },
            'thread': {
                multiBlock: true,
                minBlocks: 2,
                maxBlocks: 25,
                blockTemplate: {
                    main: { title: 'Tweet du thread', placeholder: 'Contenu de ce tweet...', required: true, min: 20, max: 280 }
                },
                tips: 'Premier tweet accrocheur, développez l\'idée progressivement, numérotez si nécessaire pour la clarté.'
            },
            'document': {
                multiBlock: true,
                minBlocks: 2,
                maxBlocks: 20,
                globalFields: {
                    caption: { title: 'Description du document', placeholder: 'Description de votre document LinkedIn...', required: true, min: 50, max: 1300 }
                },
                blockTemplate: {
                    main: { title: 'Contenu de la slide', placeholder: 'Contenu/titre de cette slide ou cochez "Pas de texte" si slide visuelle uniquement...', required: false, min: 0, max: 200, allowEmpty: true }
                },
                tips: 'Document LinkedIn : chaque slide doit apporter de la valeur, utilisez des données et visuels impactants.'
            },
            'epingle-idee': {
                multiBlock: true,
                minBlocks: 2,
                maxBlocks: 5,
                globalFields: {
                    caption: { title: 'Description de l\'épingle', placeholder: 'Description de votre tutoriel Pinterest...', required: true, min: 50, max: 500 }
                },
                blockTemplate: {
                    main: { title: 'Étape du tutoriel', placeholder: 'Décrivez cette étape ou cochez "Pas de texte" si étape visuelle uniquement...', required: false, min: 0, max: 200, allowEmpty: true }
                },
                tips: 'Épingle idée Pinterest : chaque étape doit être claire et actionnable pour l\'utilisateur.'
            },

            // === FORMATS LONGS ===
            'article': {
                blocks: [
                    { type: 'title', title: 'Titre', placeholder: 'Titre accrocheur de votre article...', required: true, min: 20, max: 150 },
                    { type: 'main', title: 'Contenu de l\'article', placeholder: 'Rédigez votre article LinkedIn...', required: true, min: 300, max: 125000 }
                ],
                tips: 'Article LinkedIn : Structure claire, valeur ajoutée, appel à l\'action en fin d\'article. Pas de limite stricte de caractères.'
            },

            // === FORMATS PINTEREST SIMPLE ===
            'epingle': {
                blocks: [
                    { type: 'main', title: 'Titre de l\'épingle', placeholder: 'Titre accrocheur pour votre épingle...', required: true, min: 20, max: 100 },
                    { type: 'caption', title: 'Légende', placeholder: 'Description SEO de votre épingle...', required: true, min: 50, max: 2200 }
                ],
                tips: 'Utilisez des mots-clés pertinents et un titre accrocheur pour optimiser la découverte sur Pinterest.'
            }
        };

        // Configuration des visuels par format (pour l'étape 4) - Nouveau système modulaire
        const visualConfig = {
            // === FORMATS THREADS (META) ===
            'threads-threads': {
                required: false,
                minImages: 0,
                maxImages: 3,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 500
                },
                skipButton: true,
                dimensions: 'Carrées (1:1) ou rectangulaires (4:5)',
                formats: 'JPEG, PNG, GIF, WEBP, PDF',
                tips: 'Threads : Visuels optionnels pour enrichir votre message textuel.'
            },

            // === FORMATS TWITTER/X ===
            'twitter-tweet': {
                required: false,
                minImages: 0,
                maxImages: 1,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 300
                },
                skipButton: true,
                dimensions: 'Rectangulaires (16:9) ou carrées (1:1)',
                formats: 'JPEG, PNG, GIF, WEBP, PDF',
                tips: 'Tweet : Image optionnelle pour illustrer votre message.'
            },
            'twitter-thread': {
                required: false,
                minImages: 0,
                maxImages: 5,
                explanationField: {
                    required: true, // Obligatoire si visuels ajoutés
                    conditionalRequired: true,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 100,
                    max: 800
                },
                skipButton: true,
                dimensions: 'Rectangulaires (16:9) ou carrées (1:1)',
                formats: 'JPEG, PNG, GIF, WEBP, PDF',
                tips: 'Thread : Visuels optionnels mais description obligatoire si ajoutés.'
            },

            // === FORMATS LINKEDIN ===
            'linkedin-publication': {
                required: true,
                minImages: 1,
                maxImages: 1,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 400
                },
                skipButton: false,
                dimensions: 'Rectangulaires (1.91:1) ou carrées (1:1)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Publication LinkedIn : Visuel professionnel obligatoire.'
            },
            'linkedin-document': {
                required: true,
                minImages: 'dynamic', // Basé sur contentData.blocks.length
                maxImages: 'dynamic',
                explanationField: {
                    required: true,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 100,
                    max: 1000
                },
                skipButton: false,
                dimensions: 'Format document (16:9 ou A4)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Document LinkedIn : Une image par slide, description détaillée requise.'
            },
            'linkedin-article': {
                required: false,
                minImages: 0,
                maxImages: 1,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 400
                },
                skipButton: true,
                dimensions: 'Horizontales (16:9) recommandées',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Article LinkedIn : Image d\'en-tête recommandée mais optionnelle.'
            },

            // === FORMATS INSTAGRAM ===
            'instagram-publication': {
                required: true,
                minImages: 1,
                maxImages: 1,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 400
                },
                skipButton: false,
                dimensions: 'Carrées (1:1) ou verticales (4:5)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Publication Instagram : Visuel haute qualité obligatoire.'
            },
            'instagram-carrousel': {
                required: true,
                minImages: 'dynamic', // Basé sur contentData.blocks.length
                maxImages: 'dynamic',
                explanationField: {
                    required: true,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 100,
                    max: 800
                },
                skipButton: false,
                dimensions: 'Verticales (4:5) recommandées',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Carrousel Instagram : Une image par slide, cohérence visuelle importante.'
            },
            'instagram-story': {
                required: true,
                minImages: 1,
                maxImages: 1,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 300
                },
                skipButton: false,
                dimensions: 'Verticales (9:16)',
                formats: 'JPEG, PNG, GIF',
                tips: 'Story Instagram : Format vertical, contenu authentique.'
            },
            'instagram-reel': {
                required: true,
                minImages: 1,
                maxImages: 5,
                explanationField: {
                    required: true,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 100,
                    max: 800
                },
                skipButton: false,
                dimensions: 'Verticales (9:16)',
                formats: 'JPEG, PNG (extraits vidéo)',
                tips: 'Reel Instagram : Extraits vidéo avec description de la narration.'
            },

            // === FORMATS FACEBOOK ===
            'facebook-publication': {
                required: true,
                minImages: 1,
                maxImages: 1,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 400
                },
                skipButton: false,
                dimensions: 'Rectangulaires (1.91:1) ou carrées (1:1)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Publication Facebook : Visuel engageant obligatoire.'
            },
            'facebook-story': {
                required: true,
                minImages: 1,
                maxImages: 1,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 300
                },
                skipButton: false,
                dimensions: 'Verticales (9:16)',
                formats: 'JPEG, PNG, GIF',
                tips: 'Story Facebook : Format vertical, contenu authentique.'
            },
            'facebook-reel': {
                required: true,
                minImages: 1,
                maxImages: 5,
                explanationField: {
                    required: true,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 100,
                    max: 800
                },
                skipButton: false,
                dimensions: 'Verticales (9:16)',
                formats: 'JPEG, PNG (extraits vidéo)',
                tips: 'Reel Facebook : Extraits vidéo avec description de la narration.'
            },

            // === FORMATS TIKTOK ===
            'tiktok-video': {
                required: true,
                minImages: 1,
                maxImages: 5,
                explanationField: {
                    required: true,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 100,
                    max: 800
                },
                skipButton: false,
                dimensions: 'Verticales (9:16)',
                formats: 'JPEG, PNG (extraits vidéo)',
                tips: 'TikTok : Extraits vidéo avec description du rythme et de l\'intention.'
            },
            'tiktok-multi-sequences': {
                required: true,
                minImages: 'dynamic', // Basé sur contentData.blocks.length
                maxImages: 'dynamic',
                explanationField: {
                    required: true,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 100,
                    max: 800
                },
                skipButton: false,
                dimensions: 'Verticales (9:16)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Multi-séquences TikTok : Une image par séquence, cohérence narrative.'
            },

            // === FORMATS YOUTUBE ===
            'youtube-short': {
                required: true,
                minImages: 1,
                maxImages: 5,
                explanationField: {
                    required: true,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 100,
                    max: 800
                },
                skipButton: false,
                dimensions: 'Verticales (9:16)',
                formats: 'JPEG, PNG (extraits vidéo)',
                tips: 'YouTube Short : Extraits vidéo avec description détaillée.'
            },

            // === FORMATS PINTEREST ===
            'pinterest-epingle': {
                required: true,
                minImages: 1,
                maxImages: 1,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 400
                },
                skipButton: false,
                dimensions: 'Verticales (2:3 ou 1000x1500px)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Épingle Pinterest : Format vertical avec texte lisible.'
            },
            'pinterest-epingle-idee': {
                required: true,
                minImages: 2,
                maxImages: 5,
                explanationField: {
                    required: true,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 100,
                    max: 600
                },
                skipButton: false,
                dimensions: 'Verticales (2:3 ou 1000x1500px)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Épingle idée Pinterest : Tutoriel étape par étape, visuels clairs.'
            },

            // === FORMATS GENERIQUES ===
            'thread': {
                required: false,
                minImages: 0,
                maxImages: 5,
                skipButton: true,
                dimensions: 'Carrées (1:1) ou rectangulaires (16:9)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Thread : Visuels optionnels pour illustrer et renforcer vos points clés.'
            },
            'document': {
                required: false,
                minImages: 0,
                maxImages: 10,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 600
                },
                skipButton: true,
                dimensions: 'Rectangulaires (16:9) ou carrées (1:1)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Document : Visuels optionnels comme graphiques, schémas ou illustrations.'
            },
            'publication': {
                required: false,
                minImages: 0,
                maxImages: 1,
                skipButton: true,
                dimensions: 'Carrées (1:1) ou rectangulaires (16:9)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Publication : Visuel optionnel pour accompagner votre contenu.'
            },
            'carrousel': {
                required: false,
                minImages: 0,
                maxImages: 10,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 600
                },
                skipButton: true,
                dimensions: 'Carrées (1:1)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Carrousel : Une image par slide pour accompagner le contenu.'
            },
            'story': {
                required: false,
                minImages: 0,
                maxImages: 1,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 300
                },
                skipButton: true,
                dimensions: 'Verticales (9:16)',
                formats: 'JPEG, PNG, GIF',
                tips: 'Story : Visuel optionnel au format vertical.'
            },
            'reel': {
                required: false,
                minImages: 0,
                maxImages: 5,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 500
                },
                skipButton: true,
                dimensions: 'Verticales (9:16)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Reel : Visuels optionnels pour accompagner votre contenu vidéo.'
            },
            'video': {
                required: false,
                minImages: 0,
                maxImages: 5,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 500
                },
                skipButton: true,
                dimensions: 'Verticales (9:16)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Vidéo : Visuels optionnels pour accompagner votre contenu vidéo.'
            },
            'short': {
                required: false,
                minImages: 0,
                maxImages: 5,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 500
                },
                skipButton: true,
                dimensions: 'Verticales (9:16)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Short : Visuels optionnels pour accompagner votre vidéo courte.'
            },
            'tweet': {
                required: false,
                minImages: 0,
                maxImages: 1,
                skipButton: true,
                dimensions: 'Rectangulaires (16:9) ou carrées (1:1)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Tweet : Image optionnelle pour illustrer votre message.'
            },
            'multi-sequences': {
                required: false,
                minImages: 0,
                maxImages: 10,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 600
                },
                skipButton: true,
                dimensions: 'Verticales (9:16)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Multi-séquences : Visuels optionnels pour accompagner chaque séquence.'
            },
            'article': {
                required: false,
                minImages: 0,
                maxImages: 5,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 600
                },
                skipButton: true,
                dimensions: 'Rectangulaires (16:9) ou carrées (1:1)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Article : Visuels optionnels pour illustrer votre article.'
            },
            'epingle': {
                required: false,
                minImages: 0,
                maxImages: 1,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 400
                },
                skipButton: true,
                dimensions: 'Verticales (2:3)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Épingle : Visuel optionnel au format vertical Pinterest.'
            },
            'epingle-idee': {
                required: false,
                minImages: 0,
                maxImages: 5,
                explanationField: {
                    required: false,
                    placeholder: 'Explique ce que montrent les visuels, la logique ou l\'intention visuelle.',
                    min: 50,
                    max: 500
                },
                skipButton: true,
                dimensions: 'Verticales (2:3)',
                formats: 'JPEG, PNG, WEBP, PDF',
                tips: 'Épingle idée : Visuels optionnels pour chaque étape du tutoriel.'
            }
        };

        // Gestion de la sélection des plateformes
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser la modal de support
            initSupportModal();

            const platformCards = document.querySelectorAll('.platform-card');
            const btnSuivant1 = document.getElementById('btn-suivant-1');

            platformCards.forEach(card => {
                card.addEventListener('click', function() {
                    // Désélectionner toutes les cartes
                    platformCards.forEach(c => c.classList.remove('selected'));
                    
                    // Sélectionner la carte cliquée
                    this.classList.add('selected');
                    selectedPlatform = this.dataset.platform;
                    
                    // Reset format quand on change de plateforme
                    selectedFormat = null;
                    
                    // Mettre à jour tous les rappels
                    for (let i = 2; i <= 5; i++) {
                        updateSelectionReminder(i);
                    }
                    
                    // Activer le bouton suivant
                    btnSuivant1.disabled = false;
                    
                    console.log('Plateforme sélectionnée:', selectedPlatform);
                });
            });

            // Gestion du bouton suivant
            btnSuivant1.onclick = function() {
                if (selectedPlatform) {
                    showStep(2);
                    generateFormats(selectedPlatform);
                }
            };

            // Gestion de l'étape 2
            initStep2();
        });

        // Fonction pour générer les formats selon la plateforme
        function generateFormats(platform) {
            const formatsContainer = document.getElementById('formats-container');
            const formats = platformFormats[platform] || [];
            
            formatsContainer.innerHTML = '';
            
            formats.forEach(format => {
                const formatCard = document.createElement('div');
                formatCard.className = 'format-card';
                formatCard.dataset.format = format.id;
                
                formatCard.innerHTML = `
                    <div class="format-icon ${format.iconClass}">
                        ${generateFormatIcon(format.id)}
                    </div>
                    <h3 class="format-name">${format.name}</h3>
                    <p class="format-description">${format.description}</p>
                    <div class="format-badges">
                        <span class="format-badge type">${format.badges[0]}</span>
                        <span class="format-badge requirement">${format.badges[1]}</span>
                    </div>
                `;
                
                formatsContainer.appendChild(formatCard);
            });
            
            // Ajouter les événements aux nouvelles cartes
            attachFormatEvents();
        }

        // Fonction pour obtenir les SVG des icônes de format
        function getFormatSVG(iconClass) {
            const svgPaths = {
                'publication': '<path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>',
                'carrousel': '<path d="M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2zm-11.5 0L9 13l1.5 2 2-2.5 2.5 3h-4zm-6.5 0V8c0-1.1.9-2 2-2h1v12H6c-1.1 0-2-.9-2-2z"/>',
                'reel': '<path d="M18 3v2h-2V3H8v2H6V3H4v18h2v-2h2v2h8v-2h2v2h2V3h-2zM8 17H6v-2h2v2zm0-4H6v-2h2v2zm0-4H6V7h2v2zm10 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z"/>',
                'story': '<path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>',
                'tiktok': '<path d="M19.14 6.86c-.28-.28-.7-.28-.98 0L12 12.83 5.84 6.67c-.28-.28-.7-.28-.98 0s-.28.7 0 .98L11.03 13.5 4.86 19.67c-.28.28-.28.7 0 .98.14.14.32.21.5.21s.36-.07.5-.21L12 14.48l6.14 6.17c.14.14.32.21.5.21s.36-.07.5-.21c.28-.28.28-.7 0-.98L13.97 13.5l6.17-5.85c.28-.28.28-.7 0-.98z"/>',
                'short': '<path d="M19 7h-8v6h8V7zm-2 4h-4V9h4v2zm4-6.5v11c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2v-11C3 3.4 3.9 2.5 5 2.5h14c1.1 0 2 .9 2 2z"/>',
                'document': '<path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>',
                'tweet': '<path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 13.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>',
                'thread': '<path d="M3 12l2-2 2 2-2 2-2-2zm0-7l2-2 2 2-2 2L3 5zm0 14l2-2 2 2-2 2-2-2zm4 0h14v-2H7v2zm0-7h14v-2H7v2zm0-7v2h14V5H7z"/>',
                'epingle': '<path d="M16 4h4v4c0 1.1-.9 2-2 2h-2l-4 4h-2l2-2-3-3 2-2V5c0-1.1.9-2 2-2z"/>',
                'epingle-idee': '<path d="M9 21c0 .5.4 1 1 1h4c.6 0 1-.5 1-1v-1H9v1zm3-19C8.1 2 5 5.1 5 9c0 2.4 1.2 4.5 3 5.7V17c0 .5.4 1 1 1h6c.6 0 1-.5 1-1v-2.3c1.8-1.3 3-3.4 3-5.7 0-3.9-3.1-7-7-7z"/>'
            };
            return svgPaths[iconClass] || svgPaths['publication'];
        }

        // Fonction pour attacher les événements aux cartes de format
        function attachFormatEvents() {
            const formatCards = document.querySelectorAll('.format-card');
            const btnSuivant2 = document.getElementById('btn-suivant-2');
            
            formatCards.forEach(card => {
                card.addEventListener('click', function() {
                    // Désélectionner toutes les cartes
                    formatCards.forEach(c => c.classList.remove('selected'));
                    
                    // Sélectionner la carte cliquée
                    this.classList.add('selected');
                    selectedFormat = this.dataset.format;
                    
                    // Mettre à jour tous les rappels à partir de l'étape 3
                    for (let i = 3; i <= 5; i++) {
                        updateSelectionReminder(i);
                    }
                    
                    // Activer le bouton suivant
                    btnSuivant2.disabled = false;
                    
                    console.log('Format sélectionné:', selectedFormat);
                });
            });
        }

        // Initialisation de l'étape 2
        function initStep2() {
            const btnRetour2 = document.getElementById('btn-retour-2');
            const btnSuivant2 = document.getElementById('btn-suivant-2');
            
            // Fonction pour le bouton retour
            function handleRetour() {
                showStep(1);
                selectedFormat = null;
            }
            
            // Fonction pour le bouton suivant
            function handleSuivant() {
                if (selectedFormat) {
                    showStep(3);
                    generateContentBlocks(selectedFormat);
                }
            }
            
            // Assigner les handlers avec onclick
            btnRetour2.onclick = handleRetour;
            btnSuivant2.onclick = handleSuivant;
        }

        // Fonction pour générer les blocs de contenu selon le format
        function generateContentBlocks(format) {
            const config = contentConfig[format];
            if (!config) return;

            // Mettre à jour le sous-titre et les conseils
            document.getElementById('content-subtitle').textContent = 
                `Créez votre ${platformFormats[selectedPlatform].find(f => f.id === format).name.toLowerCase()}`;
            document.getElementById('tips-content').textContent = config.tips;

            const container = document.getElementById('content-blocks-container');
            const addButton = document.getElementById('btn-add-slide');
            
            container.innerHTML = '';
            contentData = { blocks: [] };

            if (config.multiBlock) {
                // Format carrousel/thread
                addButton.style.display = 'block';
                
                // Ajouter les champs globaux d'abord (comme la légende générale)
                if (config.globalFields) {
                    Object.entries(config.globalFields).forEach(([key, fieldConfig]) => {
                        createGlobalField(key, fieldConfig);
                    });
                }
                
                // Créer 2 blocs par défaut
                for (let i = 0; i < 2; i++) {
                    createContentBlock(config.blockTemplate, i + 1, config.multiBlock);
                }
                
                // Gérer le bouton d'ajout
                addButton.onclick = function() {
                    if (contentData.blocks.length < config.maxBlocks) {
                        createContentBlock(config.blockTemplate, contentData.blocks.length + 1, config.multiBlock);
                        updateValidation();
                    }
                    if (contentData.blocks.length >= config.maxBlocks) {
                        addButton.style.display = 'none';
                    }
                };
            } else {
                // Format simple
                addButton.style.display = 'none';
                
                config.blocks.forEach((blockConfig, index) => {
                    createContentBlock({ [blockConfig.type]: blockConfig }, index + 1, false);
                });
            }

            // Validation initiale
            updateValidation();
        }

        // Fonction pour créer un champ global (comme la légende générale du carrousel)
        function createGlobalField(key, config) {
            const container = document.getElementById('content-blocks-container');
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'content-block global-field';
            
            const fieldId = `global-${key}-${Date.now()}`;
            const isRequired = config.required ? '' : '<span class="optional-label">(facultatif)</span>';
            
            fieldDiv.innerHTML = `
                <div class="block-header">
                    <div class="block-title">
                        <span class="block-number">📝</span>
                        ${config.title} ${isRequired}
                    </div>
                </div>
                <div class="textarea-container">
                    <textarea 
                        class="content-textarea" 
                        id="${fieldId}"
                        placeholder="${config.placeholder}"
                        data-min="${config.min}"
                        data-max="${config.max}"
                        data-required="${config.required}"
                        data-type="global-${key}"
                    ></textarea>
                    <div class="char-counter" id="counter-${fieldId}">0/${config.max}</div>
                </div>
            `;
            
            container.appendChild(fieldDiv);
            
            // Ajouter les événements au textarea
            const textarea = fieldDiv.querySelector('textarea');
            textarea.addEventListener('input', function() {
                updateCharCounter(this);
                updateValidation();
            });
        }

        // Fonction pour créer un bloc de contenu
        function createContentBlock(template, number, isMultiBlock) {
            const container = document.getElementById('content-blocks-container');
            const blockDiv = document.createElement('div');
            blockDiv.className = 'content-block';
            blockDiv.dataset.blockNumber = number;

            let blockHTML = '';
            
            Object.entries(template).forEach(([key, config]) => {
                const fieldId = `${key}-${number}`;
                const isRequired = config.required ? '' : '<span class="optional-label">(facultatif)</span>';
                const canDelete = isMultiBlock && contentData.blocks.length >= 2;
                
                // Vérifier si ce champ peut être vide (allowEmpty)
                const allowEmptyCheckbox = config.allowEmpty ? `
                    <div class="checkbox-container" style="margin-bottom: 10px;">
                        <label>
                            <input type="checkbox" id="empty-${fieldId}" class="empty-checkbox" onchange="toggleEmptyField('${fieldId}')">
                            Pas de texte sur cette slide (visuel uniquement)
                        </label>
                    </div>
                ` : '';
                
                blockHTML += `
                    <div class="block-header">
                        <div class="block-title">
                            <span class="block-number">${number}</span>
                            ${config.title} ${isRequired}
                        </div>
                        ${canDelete ? '<button class="btn-delete" onclick="deleteBlock(this)">Supprimer</button>' : ''}
                    </div>
                    ${allowEmptyCheckbox}
                    <div class="textarea-container">
                        <textarea 
                            class="content-textarea" 
                            id="${fieldId}"
                            placeholder="${config.placeholder}"
                            data-min="${config.min}"
                            data-max="${config.max}"
                            data-required="${config.required}"
                            data-type="${key}"
                            data-allow-empty="${config.allowEmpty || false}"
                        ></textarea>
                        <div class="char-counter" id="counter-${fieldId}">0/${config.max}</div>
                    </div>
                `;
            });

            blockDiv.innerHTML = blockHTML;
            container.appendChild(blockDiv);

            // Ajouter les événements aux textareas
            blockDiv.querySelectorAll('textarea').forEach(textarea => {
                textarea.addEventListener('input', function() {
                    updateCharCounter(this);
                    updateValidation();
                });
            });

            // Stocker les données du bloc
            const blockData = { number, fields: {} };
            Object.entries(template).forEach(([key, config]) => {
                const fieldId = `${key}-${number}`;
                blockData.fields[key] = { 
                    value: '', 
                    config: config,
                    id: fieldId 
                };
            });
            contentData.blocks.push(blockData);
        }

        // Fonction pour gérer la checkbox "Pas de texte"
        function toggleEmptyField(fieldId) {
            const checkbox = document.getElementById(`empty-${fieldId}`);
            const textarea = document.getElementById(fieldId);
            const counter = document.getElementById(`counter-${fieldId}`);
            
            if (checkbox.checked) {
                // Désactiver le textarea
                textarea.disabled = true;
                textarea.value = '';
                textarea.placeholder = 'Cette slide ne contient pas de texte (visuel uniquement)';
                counter.textContent = 'Pas de texte';
                counter.className = 'char-counter good';
            } else {
                // Réactiver le textarea
                textarea.disabled = false;
                const config = JSON.parse(textarea.dataset.config || '{}');
                textarea.placeholder = config.placeholder || textarea.dataset.placeholder || '';
                updateCharCounter(textarea);
            }
            
            updateValidation();
        }

        // Fonction pour mettre à jour le compteur de caractères
        function updateCharCounter(textarea) {
            const length = textarea.value.length;
            const max = parseInt(textarea.dataset.max);
            const min = parseInt(textarea.dataset.min);
            const allowEmpty = textarea.dataset.allowEmpty === 'true';
            const counter = document.getElementById(`counter-${textarea.id}`);
            const checkbox = document.getElementById(`empty-${textarea.id}`);
            const isEmptyAllowed = checkbox && checkbox.checked;
            
            counter.textContent = `${length}/${max}`;
            
            // Colorier selon les seuils
            counter.className = 'char-counter';
            if (length > max) {
                counter.classList.add('danger');
            } else if (isEmptyAllowed && allowEmpty) {
                // Si "pas de texte" est coché et autorisé, toujours vert
                counter.classList.add('good');
            } else if (allowEmpty && length > 0 && length < 20) {
                // Pour les champs allowEmpty, minimum 20 caractères si on tape du texte
                counter.classList.add('danger');
            } else if (!allowEmpty && length < min) {
                // Pour les champs obligatoires, utiliser le min classique
                counter.classList.add('danger');
            } else {
                counter.classList.add('good');
            }

            // Mettre à jour les données
            const blockNumber = parseInt(textarea.closest('.content-block').dataset.blockNumber);
            const fieldType = textarea.dataset.type;
            const blockData = contentData.blocks.find(b => b.number === blockNumber);
            if (blockData) {
                blockData.fields[fieldType].value = textarea.value;
            }
            
            // Déclencher la validation
            updateValidation();
        }

        // Fonction pour supprimer un bloc
        function deleteBlock(button) {
            const block = button.closest('.content-block');
            const blockNumber = parseInt(block.dataset.blockNumber);
            
            // Supprimer du DOM
            block.remove();
            
            // Supprimer des données si elles existent
            if (contentData.blocks) {
                contentData.blocks = contentData.blocks.filter(b => b.number !== blockNumber);
            }
            
            // Renuméroter les blocs restants
            renumberBlocks();
            
            // Réafficher le bouton d'ajout si nécessaire
            const addButton = document.getElementById('btn-add-slide');
            const remainingBlocks = document.querySelectorAll('.content-block').length;
            const config = contentConfig[selectedFormat];
            
            if (remainingBlocks < config.maxBlocks) {
                addButton.style.display = 'block';
            }
            
            // Relancer la validation
            updateValidation();
        }

        // Fonction pour renuméroter les blocs de contenu (pas les champs globaux)
        function renumberBlocks() {
            const blocks = document.querySelectorAll('.content-block');
            blocks.forEach((block, index) => {
                const newNumber = index + 1;
                block.dataset.blockNumber = newNumber;
                
                const numberSpan = block.querySelector('.block-number');
                if (numberSpan && !numberSpan.textContent.includes('📝')) {
                    numberSpan.textContent = newNumber;
                }
                
                // Mettre à jour les IDs des éléments dans le bloc
                const textareas = block.querySelectorAll('textarea');
                textareas.forEach(textarea => {
                    // Ne pas modifier les champs globaux
                    if (!textarea.dataset.type.startsWith('global-')) {
                        const fieldType = textarea.dataset.type;
                        const oldId = textarea.id;
                        const newId = `${fieldType}-${newNumber}`;
                        
                        // Mettre à jour l'ID du textarea
                        textarea.id = newId;
                        
                        // Mettre à jour l'ID du compteur
                        const counter = document.getElementById(`counter-${oldId}`);
                        if (counter) {
                            counter.id = `counter-${newId}`;
                        }
                        
                        // Mettre à jour l'ID de la checkbox
                        const checkbox = document.getElementById(`empty-${oldId}`);
                        if (checkbox) {
                            checkbox.id = `empty-${newId}`;
                            checkbox.setAttribute('onchange', `toggleEmptyField('${newId}')`);
                        }
                    }
                });
                
                // Mettre à jour les données si elles existent
                if (contentData.blocks && contentData.blocks[index]) {
                    contentData.blocks[index].number = newNumber;
                }
            });
        }

        // Fonction de validation CORRIGÉE - TOUTES les slides doivent être valides
        function updateValidation() {
            const validationMsg = document.getElementById('validation-message');
            const btnSuivant3 = document.getElementById('btn-suivant-3');
            let isValid = true;
            let errors = [];

            if (selectedFormat === 'carrousel') {
                let hasAtLeastOneWithText = false;
                
                document.querySelectorAll('.content-block').forEach((block) => {
                    const blockNumber = parseInt(block.dataset.blockNumber) || 1;
                    const textareas = block.querySelectorAll('textarea[data-type]:not([data-type^="global-"])');
                    let blockValid = false;
                    
                    textareas.forEach(textarea => {
                        const text = textarea.value.length;
                        const checkbox = document.getElementById(`empty-${textarea.id}`);
                        const isEmpty = checkbox && checkbox.checked;
                        
                        // Une slide est valide si elle a 20+ caractères OU si checkbox cochée
                        if (text >= 20 || isEmpty) {
                            blockValid = true;
                        }
                        
                        // Compter les slides avec du texte (pour vérifier qu'au moins une a du contenu)
                        if (text >= 20) {
                            hasAtLeastOneWithText = true;
                        }
                    });
                    
                    // Si ce bloc n'est pas valide, ajouter une erreur (SANS ⚠️ car CSS l'ajoute)
                    if (!blockValid && textareas.length > 0) {
                        isValid = false;
                        errors.push(`Slide ${blockNumber}: minimum 20 caractères ou cochez "Pas de texte"`);
                    }
                });
                
                // Vérifier qu'au moins une slide a du texte (pas que des "visuel uniquement")
                if (!hasAtLeastOneWithText) {
                    isValid = false;
                    errors.push(`Au moins une slide doit contenir du texte (pas que du visuel)`);
                }
            }

            if (errors.length > 0) {
                // Ajouter l'icône ⚠️ à chaque ligne d'erreur si elle n'est pas déjà présente
                const formattedErrors = errors.map(error => error.startsWith('⚠️') ? error : `⚠️ ${error}`);
                validationMsg.innerHTML = formattedErrors.join('<br>');
                validationMsg.classList.add('show');
            } else {
                validationMsg.classList.remove('show');
            }

            btnSuivant3.disabled = !isValid;
        }

        // Initialisation de l'étape 3
        function initStep3() {
            const btnRetour3 = document.getElementById('btn-retour-3');
            const btnSuivant3 = document.getElementById('btn-suivant-3');
            
            // Fonction pour le bouton retour
            function handleRetour() {
                showStep(2);
                contentData = {};
            }
            
            // Fonction pour le bouton suivant
            function handleSuivant() {
                if (!btnSuivant3.disabled) {
                    showStep(4);
                    initVisualStep();
                }
            }
            
            // Supprimer les anciens listeners et ajouter les nouveaux
            btnRetour3.onclick = handleRetour;
            btnSuivant3.onclick = handleSuivant;
        }

        // Fonction utilitaire pour récupérer la configuration visuelle appropriée
        function getVisualConfig(format = selectedFormat, platform = selectedPlatform) {
            // Créer une clé unique basée sur la plateforme et le format
            const configKey = `${platform}-${format}`;
            let config = visualConfig[configKey];
            
            // Si pas de config spécifique à la plateforme, utiliser le format générique
            if (!config) {
                config = visualConfig[format];
            }
            
            return config || null;
        }

        // Fonction pour initialiser l'étape visuelle - Nouveau système modulaire
        function initVisualStep() {
            const config = getVisualConfig();
            
            if (!config) {
                // Format sans configuration visuelle - passer à l'étape suivante
                showStep(5);
                generateSummary();
                return;
            }
            
            // Initialiser les données visuelles
            visualData = {
                images: [],
                explanation: '',
                skipped: false
            };
            
            // Générer le bloc visuel modulaire
            generateModularVisualBlock(selectedFormat);
            
            // Configurer les événements d'upload
            setupModularUploadEvents();
            
            // Initialiser le compteur de caractères du champ d'explication s'il existe
            setTimeout(() => {
                const explanationTextarea = document.getElementById('visual-explanation');
                if (explanationTextarea) {
                    updateExplanationCharCounter(explanationTextarea);
                }
            }, 100);
        }

        // Fonction pour générer le bloc visuel modulaire - NOUVEAU SYSTÈME
        function generateModularVisualBlock(format) {
            const config = getVisualConfig(format);
            
            if (!config) return;

            // Mettre à jour le titre et les conseils
            const formatName = platformFormats[selectedPlatform].find(f => f.id === format).name;
            document.getElementById('visual-subtitle').textContent = `Visuels pour votre ${formatName.toLowerCase()}`;
            document.getElementById('tips-visual').textContent = config.tips;

            const container = document.getElementById('visual-blocks-container');
            container.innerHTML = '';

            // Calculer le nombre d'images requis (dynamique pour certains formats)
            const requiredImageCount = getRequiredImageCount(config);

            // Créer le bloc visuel modulaire
            const visualBlock = document.createElement('div');
            visualBlock.className = 'modular-visual-block';
            visualBlock.innerHTML = `
                <div class="visual-block-header">
                    <div class="format-icon">${generateFormatIcon(format)}</div>
                    <div class="visual-requirements">
                        <span class="requirement-label">${config.required ? 'Obligatoire' : 'Facultatif'}</span>
                        <span class="image-count">${requiredImageCount.min === requiredImageCount.max ? 
                            requiredImageCount.min + ' image(s)' : 
                            requiredImageCount.min + '-' + requiredImageCount.max + ' images'}</span>
                        <span class="formats">${config.formats}</span>
                    </div>
                </div>

                <div class="upload-zone ${!config.required && visualData.skipped ? 'disabled' : ''}" id="upload-zone">
                    <div class="upload-area" id="upload-area">
                        <div class="upload-icon">📁</div>
                        <div class="upload-text">
                            <div class="upload-title">Ajouter un visuel</div>
                            <div class="upload-subtitle">Glissez-déposez vos images ou cliquez pour sélectionner</div>
                        </div>
                        <button type="button" class="btn-upload" id="btn-upload">Choisir des fichiers</button>
                    </div>
                    <input type="file" id="file-input" multiple accept="image/*" style="display: none;">
                </div>

                <div class="preview-container" id="preview-container" style="display: none;">
                    <div class="preview-header">
                        <span class="preview-title">Visuels sélectionnés</span>
                        <span class="preview-counter" id="preview-counter">0/${requiredImageCount.max}</span>
                    </div>
                    <div class="preview-thumbnails" id="preview-thumbnails">
                        <!-- Miniatures des visuels avec modal au hover -->
                    </div>
                </div>

                ${config.explanationField ? `
                <div class="explanation-field" id="explanation-field" style="display: ${config.explanationField.conditionalRequired && visualData.images.length === 0 ? 'none' : 'block'};">
                    <label for="visual-explanation" class="explanation-label">
                        Description des visuels ${config.explanationField.required ? '*' : '(facultatif)'}
                    </label>
                    <div class="textarea-container">
                        <textarea 
                            id="visual-explanation" 
                            class="explanation-textarea"
                            placeholder="${config.explanationField.placeholder}"
                            data-min="${config.explanationField.min}"
                            data-max="${config.explanationField.max}"
                            data-required="${config.explanationField.required}"
                            oninput="updateExplanationCharCounter(this)"
                        ></textarea>
                        <div class="char-counter" id="counter-visual-explanation">0/${config.explanationField.max}</div>
                    </div>
                </div>
                ` : ''}

                ${config.skipButton ? `
                <div class="skip-section">
                    <button type="button" class="btn-skip-visual" id="btn-skip-visual">
                        Continuer sans visuel
                    </button>
                </div>
                ` : ''}

                <div class="no-visual-state" id="no-visual-state" style="display: ${visualData.skipped ? 'block' : 'none'};">
                    <div class="no-visual-message">
                        <div class="no-visual-icon">🚫</div>
                        <div class="no-visual-text">Aucun visuel fourni pour ce format (optionnel)</div>
                        <button type="button" class="btn-add-visual" id="btn-add-visual">Ajouter des visuels</button>
                    </div>
                </div>
            `;

            container.appendChild(visualBlock);

            // Validation initiale
            updateModularVisualValidation();
        }

        // FONCTIONNALITÉ AJOUTÉE : Fonction pour calculer le nombre d'images requis dynamiquement
        function getRequiredImageCount(config = null) {
            if (!config) {
                config = getVisualConfig();
            }
            if (!config) {
                return { min: 0, max: 0 };
            }
            
            if (config.minImages === 'dynamic' || config.maxImages === 'dynamic') {
                const contentBlocksCount = contentData.blocks ? contentData.blocks.length : 1;
                return {
                    min: config.minImages === 'dynamic' ? contentBlocksCount : config.minImages,
                    max: config.maxImages === 'dynamic' ? contentBlocksCount : config.maxImages
                };
            }
            return {
                min: config.minImages,
                max: config.maxImages
            };
        }

        // NOUVEAU SYSTÈME : Configuration des événements d'upload modulaires
        function setupModularUploadEvents() {
            const uploadArea = document.getElementById('upload-area');
            const fileInput = document.getElementById('file-input');
            const btnUpload = document.getElementById('btn-upload');
            const btnSkipVisual = document.getElementById('btn-skip-visual');
            const btnAddVisual = document.getElementById('btn-add-visual');
            const explanationTextarea = document.getElementById('visual-explanation');

            if (!uploadArea || !fileInput) return;

            // Événements pour la zone d'upload - un seul event listener
            if (btnUpload) {
                btnUpload.addEventListener('click', () => fileInput.click());
            } else {
                uploadArea.addEventListener('click', () => fileInput.click());
            }

            // Drag & Drop
            uploadArea.addEventListener('dragover', handleModularDragOver);
            uploadArea.addEventListener('dragleave', handleModularDragLeave);
            uploadArea.addEventListener('drop', handleModularDrop);

            // Sélection de fichiers
            fileInput.addEventListener('change', handleModularFileSelect);

            // Bouton ignorer visuels
            if (btnSkipVisual) {
                btnSkipVisual.addEventListener('click', function() {
                    toggleSkipVisual(true);
                });
            }

            // Bouton ajouter visuels (quand ignoré)
            if (btnAddVisual) {
                btnAddVisual.addEventListener('click', function() {
                    toggleSkipVisual(false);
                });
            }

            // Textarea d'explication
            if (explanationTextarea) {
                explanationTextarea.addEventListener('input', function() {
                    updateModularVisualValidation();
                });
            }
        }

        // FONCTIONNALITÉ AJOUTÉE : Gestion du mode "ignorer visuels"
        function toggleSkipVisual(skip) {
            visualData.skipped = skip;
            const uploadZone = document.getElementById('upload-zone');
            const noVisualState = document.getElementById('no-visual-state');
            const explanationField = document.getElementById('explanation-field');

            if (skip) {
                uploadZone.classList.add('disabled');
                noVisualState.style.display = 'block';
                visualData.images = [];
                updatePreviewContainer();
                
                // Masquer le champ d'explication si conditionnel
                const config = getVisualConfig();
                if (config && config.explanationField && config.explanationField.conditionalRequired) {
                    explanationField.style.display = 'none';
                }
            } else {
                uploadZone.classList.remove('disabled');
                noVisualState.style.display = 'none';
                
                // Réafficher le champ d'explication
                if (explanationField) {
                    explanationField.style.display = 'block';
                }
            }

            updateModularVisualValidation();
        }

        // Gestion du drag & drop modernisée
        function handleModularDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleModularDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
        }

        function handleModularDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            processModularFiles(files);
        }

        function handleModularFileSelect(e) {
            const files = Array.from(e.target.files);
            processModularFiles(files);
        }

        // FONCTIONNALITÉ AJOUTÉE : Traitement avancé des fichiers avec validation
        function processModularFiles(files) {
            const config = getVisualConfig();
            const imageCount = getRequiredImageCount(config);
            
            // Filtrer les fichiers images
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length === 0) {
                showUploadFeedback('Veuillez sélectionner des fichiers image valides.', 'error');
                return;
            }

            // Vérifier les limites
            const totalAfterUpload = visualData.images.length + imageFiles.length;
            if (totalAfterUpload > imageCount.max) {
                showUploadFeedback(`Maximum ${imageCount.max} image(s) autorisée(s) pour ce format.`, 'error');
                return;
            }

            // Traiter chaque fichier
            imageFiles.forEach(file => {
                if (visualData.images.length < imageCount.max) {
                    addImageToPreview(file);
                }
            });

            // Afficher le champ d'explication si conditionnel
            const explanationField = document.getElementById('explanation-field');
            if (config.explanationField && config.explanationField.conditionalRequired && explanationField) {
                explanationField.style.display = 'block';
            }

            showUploadFeedback(`${imageFiles.length} image(s) ajoutée(s) avec succès.`, 'success');
            updateModularVisualValidation();
        }

        // FONCTIONNALITÉ AJOUTÉE : Système de preview avec lightbox et réorganisation
        function addImageToPreview(file) {
            const imageData = {
                file: file,
                name: file.name,
                size: file.size,
                type: file.type,
                id: Date.now() + Math.random()
            };

            visualData.images.push(imageData);
            updatePreviewContainer();
        }

        function updatePreviewContainer() {
            const previewContainer = document.getElementById('preview-container');
            const previewThumbnails = document.getElementById('preview-thumbnails');
            const previewCounter = document.getElementById('preview-counter');

            if (visualData.images.length === 0) {
                previewContainer.style.display = 'none';
                return;
            }

            previewContainer.style.display = 'block';
            
            // Mettre à jour le compteur avec nouveau design
            const config = getVisualConfig();
            const imageCount = getRequiredImageCount(config);
            previewCounter.textContent = `${visualData.images.length}/${imageCount.max}`;

            // Générer les miniatures avec nouveau design et modal
            previewThumbnails.innerHTML = '';
            visualData.images.forEach((image, index) => {
                const thumbnail = document.createElement('div');
                thumbnail.className = 'preview-item';
                thumbnail.dataset.index = index;
                thumbnail.draggable = true;
                
                // Créer la preview de l'image
                const reader = new FileReader();
                reader.onload = function(e) {
                    thumbnail.innerHTML = `
                        <img src="${e.target.result}" alt="${image.name}" class="preview-thumbnail" onclick="showImageModal('${e.target.result}')" />
                        <div class="preview-info">
                            <span class="image-name">${image.name}</span>
                            <span class="image-order">${index + 1}/${visualData.images.length}</span>
                        </div>
                        <div class="preview-controls">
                            ${index > 0 ? `<button class="preview-move-btn" onclick="moveImageUp(${index})" title="Déplacer vers la gauche">←</button>` : ''}
                            ${index < visualData.images.length - 1 ? `<button class="preview-move-btn" onclick="moveImageDown(${index})" title="Déplacer vers la droite">→</button>` : ''}
                        </div>
                        <div class="preview-remove-section">
                            <button class="preview-remove-btn" onclick="removeImageFromPreview(${index})" title="Supprimer cette image">
                                🗑️ Supprimer
                            </button>
                        </div>
                    `;
                };
                reader.readAsDataURL(image.file);
                
                // Événements de drag & drop
                thumbnail.addEventListener('dragstart', handleDragStart);
                thumbnail.addEventListener('dragover', handleDragOver_Reorder);
                thumbnail.addEventListener('drop', handleDrop_Reorder);
                thumbnail.addEventListener('dragend', handleDragEnd);
                
                previewThumbnails.appendChild(thumbnail);
            });

            // Créer le modal s'il n'existe pas
            if (!document.getElementById('preview-modal')) {
                const modal = document.createElement('div');
                modal.id = 'preview-modal';
                modal.className = 'preview-modal';
                modal.innerHTML = `
                    <div class="preview-modal-content">
                        <img id="modal-image" src="" alt="Aperçu" />
                    </div>
                    <button class="preview-modal-close" onclick="hideImageModal()">&times;</button>
                `;
                document.body.appendChild(modal);
                
                // Fermer au clic en dehors
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        hideImageModal();
                    }
                });
                
                // Fermer avec Échap
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        hideImageModal();
                    }
                });
            }

            updateModularVisualValidation();
        }

        // Nouvelles fonctions pour le modal d'aperçu
        function showImageModal(imageUrl) {
            const modal = document.getElementById('preview-modal');
            const modalImage = document.getElementById('modal-image');
            modalImage.src = imageUrl;
            modal.classList.add('show');
            document.body.style.overflow = 'hidden'; // Empêcher le scroll de la page
        }

        function hideImageModal() {
            const modal = document.getElementById('preview-modal');
            modal.classList.remove('show');
            document.body.style.overflow = ''; // Restaurer le scroll
        }

        // Fonctions de réorganisation des images
        let draggedElement = null;

        function handleDragStart(e) {
            draggedElement = e.target.closest('.preview-item');
            e.dataTransfer.effectAllowed = 'move';
            draggedElement.classList.add('dragging');
        }

        function handleDragOver_Reorder(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            const item = e.target.closest('.preview-item');
            if (item && item !== draggedElement) {
                item.classList.add('drag-over');
            }
        }

        function handleDrop_Reorder(e) {
            e.preventDefault();
            const dropTarget = e.target.closest('.preview-item');
            if (dropTarget && dropTarget !== draggedElement) {
                const draggedIndex = parseInt(draggedElement.dataset.index);
                const targetIndex = parseInt(dropTarget.dataset.index);
                
                // Réorganiser le tableau
                const draggedImage = visualData.images[draggedIndex];
                visualData.images.splice(draggedIndex, 1);
                visualData.images.splice(targetIndex, 0, draggedImage);
                
                // Mettre à jour l'affichage
                updatePreviewContainer();
            }
            // Nettoyer les classes
            document.querySelectorAll('.preview-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        function handleDragEnd(e) {
            if (draggedElement) {
                draggedElement.classList.remove('dragging');
                draggedElement = null;
            }
            document.querySelectorAll('.preview-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        function moveImageUp(index) {
            if (index > 0) {
                const temp = visualData.images[index];
                visualData.images[index] = visualData.images[index - 1];
                visualData.images[index - 1] = temp;
                updatePreviewContainer();
            }
        }

        function moveImageDown(index) {
            if (index < visualData.images.length - 1) {
                const temp = visualData.images[index];
                visualData.images[index] = visualData.images[index + 1];
                visualData.images[index + 1] = temp;
                updatePreviewContainer();
            }
        }

        // FONCTIONNALITÉ AJOUTÉE : Système de lightbox pour agrandissement
        function openImageLightbox(index) {
            const image = visualData.images[index];
            if (!image) return;

            const lightbox = document.createElement('div');
            lightbox.className = 'image-lightbox';
            lightbox.innerHTML = `
                <div class="lightbox-overlay" onclick="closeLightbox()"></div>
                <div class="lightbox-content">
                    <div class="lightbox-header">
                        <span class="lightbox-title">${image.name} (${index + 1}/${visualData.images.length})</span>
                        <button class="lightbox-close" onclick="closeLightbox()">×</button>
                    </div>
                    <div class="lightbox-image-container">
                        <img id="lightbox-image" src="" alt="${image.name}">
                    </div>
                    <div class="lightbox-controls">
                        ${index > 0 ? `<button onclick="navigateLightbox(${index - 1})">← Précédent</button>` : ''}
                        ${index < visualData.images.length - 1 ? `<button onclick="navigateLightbox(${index + 1})">Suivant →</button>` : ''}
                    </div>
                </div>
            `;

            document.body.appendChild(lightbox);

            // Charger l'image
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('lightbox-image').src = e.target.result;
            };
            reader.readAsDataURL(image.file);

            // Fermeture avec Échap
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closeLightbox();
            });
        }

        function closeLightbox() {
            const lightbox = document.querySelector('.image-lightbox');
            if (lightbox) {
                lightbox.remove();
            }
        }

        function navigateLightbox(newIndex) {
            closeLightbox();
            openImageLightbox(newIndex);
        }

        // FONCTIONNALITÉ AJOUTÉE : Réorganisation des images par drag & drop
        function moveImage(fromIndex, direction) {
            const toIndex = fromIndex + direction;
            if (toIndex < 0 || toIndex >= visualData.images.length) return;

            // Échanger les images
            [visualData.images[fromIndex], visualData.images[toIndex]] = [visualData.images[toIndex], visualData.images[fromIndex]];
            
            updatePreviewContainer();
            updateModularVisualValidation();
        }

        function removeImageFromPreview(index) {
            visualData.images.splice(index, 1);
            updatePreviewContainer();
            
            // Masquer le champ d'explication si conditionnel et plus d'images
            const config = getVisualConfig();
            const explanationField = document.getElementById('explanation-field');
            if (config && config.explanationField && config.explanationField.conditionalRequired && 
                visualData.images.length === 0 && explanationField) {
                explanationField.style.display = 'none';
            }
            
            updateModularVisualValidation();
        }

        // Feedback d'upload modernisé
        function showUploadFeedback(message, type = 'success') {
            const feedback = document.createElement('div');
            feedback.className = `upload-feedback ${type}`;
            feedback.textContent = message;
            
            const uploadArea = document.getElementById('upload-area');
            uploadArea.appendChild(feedback);
            
            setTimeout(() => {
                feedback.remove();
            }, 3000);
        }

        // NOUVEAU SYSTÈME : Validation modulaire des visuels
        function updateModularVisualValidation() {
            const config = getVisualConfig();
            const validationMsg = document.getElementById('visual-validation-message');
            const btnSuivant4 = document.getElementById('btn-suivant-4');
            
            if (!config) {
                btnSuivant4.disabled = false;
                return;
            }

            let isValid = true;
            let errors = [];
            const imageCount = getRequiredImageCount(config);

            // Si les visuels sont ignorés et que c'est autorisé
            if (visualData.skipped && !config.required) {
                isValid = true;
                errors = [];
            } 
            // Vérification des images
            else if (config.required) {
                if (visualData.images.length === 0) {
                    isValid = false;
                    errors.push('Au moins une image est requise pour ce format');
                } else if (visualData.images.length < imageCount.min) {
                    isValid = false;
                    errors.push(`Minimum ${imageCount.min} image(s) requise(s)`);
                } else if (visualData.images.length > imageCount.max) {
                    isValid = false;
                    errors.push(`Maximum ${imageCount.max} image(s) autorisée(s)`);
                }
            }

            // Vérification du champ d'explication
            if (config.explanationField && !visualData.skipped) {
                const explanationTextarea = document.getElementById('visual-explanation');
                if (explanationTextarea) {
                    const explanationLength = explanationTextarea.value.length;
                    const isExplanationRequired = config.explanationField.required || 
                        (config.explanationField.conditionalRequired && visualData.images.length > 0);
                    
                    if (isExplanationRequired && explanationLength < config.explanationField.min) {
                        isValid = false;
                        errors.push(`Description requise (minimum ${config.explanationField.min} caractères)`);
                    } else if (explanationLength > config.explanationField.max) {
                        isValid = false;
                        errors.push(`Description trop longue (maximum ${config.explanationField.max} caractères)`);
                    }
                }
            }

            // Ajouter les erreurs de validation des descriptions visuelles (multi-blocs)
            const visualValidationResult = updateVisualValidation();
            if (visualValidationResult && !visualValidationResult.isValid) {
                isValid = false;
                errors.push(...visualValidationResult.errors);
            }

            // Afficher les erreurs
            if (errors.length > 0) {
                // Ajouter l'icône ⚠️ à chaque ligne d'erreur si elle n'est pas déjà présente
                const formattedErrors = errors.map(error => error.startsWith('⚠️') ? error : `⚠️ ${error}`);
                validationMsg.innerHTML = formattedErrors.join('<br>');
                validationMsg.classList.add('show');
            } else {
                validationMsg.classList.remove('show');
            }

            // Activer/désactiver le bouton suivant
            btnSuivant4.disabled = !isValid;
        }

        // Fonction pour créer un champ global visuel (comme le script général)
        function createGlobalVisualField(key, config) {
            const container = document.getElementById('visual-blocks-container');
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'visual-block global-field';
            
            const fieldId = `global-visual-${key}-${Date.now()}`;
            const isRequired = config.required ? '' : '<span class="optional-label">(facultatif)</span>';
            
            fieldDiv.innerHTML = `
                <div class="block-header">
                    <div class="block-title">
                        ${config.title} ${isRequired}
                    </div>
                </div>
                <div class="textarea-container">
                    <textarea 
                        class="visual-textarea" 
                        id="${fieldId}"
                        placeholder="${config.placeholder}"
                        data-min="${config.min}"
                        data-max="${config.max}"
                        data-required="${config.required}"
                        data-type="global-${key}"
                    ></textarea>
                    <div class="char-counter" id="counter-${fieldId}">0/${config.max}</div>
                </div>
            `;
            
            container.appendChild(fieldDiv);
            
            // Ajouter les événements au textarea
            const textarea = fieldDiv.querySelector('textarea');
            textarea.addEventListener('input', function() {
                updateVisualCharCounter(this);
                updateModularVisualValidation();
            });
        }

        // Fonction pour créer un bloc visuel
        function createVisualBlock(template, number, isMultiBlock) {
            const container = document.getElementById('visual-blocks-container');
            const blockDiv = document.createElement('div');
            blockDiv.className = 'visual-block';
            blockDiv.dataset.blockNumber = number;

            let blockHTML = '';
            
            Object.entries(template).forEach(([key, config]) => {
                const fieldId = `visual-${key}-${number}-${Date.now()}`;
                const isRequired = config.required ? '' : '<span class="optional-label">(facultatif)</span>';
                const canDelete = isMultiBlock && visualData.blocks.length >= 2;
                
                blockHTML += `
                    <div class="block-header">
                        <div class="block-title">
                            <span class="block-number">${number}</span>
                            ${config.title} ${isRequired}
                        </div>
                        ${canDelete ? '<button class="btn-delete" onclick="deleteVisualBlock(this)">Supprimer</button>' : ''}
                    </div>
                    <div class="textarea-container">
                        <textarea 
                            class="visual-textarea" 
                            id="${fieldId}"
                            placeholder="${config.placeholder}"
                            data-min="${config.min}"
                            data-max="${config.max}"
                            data-required="${config.required}"
                            data-type="${key}"
                        ></textarea>
                        <div class="char-counter" id="counter-${fieldId}">0/${config.max}</div>
                    </div>
                `;
            });

            blockDiv.innerHTML = blockHTML;
            container.appendChild(blockDiv);

            // Ajouter les événements aux textareas
            blockDiv.querySelectorAll('textarea').forEach(textarea => {
                textarea.addEventListener('input', function() {
                    updateVisualCharCounter(this);
                    updateModularVisualValidation();
                });
            });

            // Stocker les données du bloc
            const blockData = { number, fields: {} };
            Object.keys(template).forEach(key => {
                blockData.fields[key] = { value: '', config: template[key] };
            });
            visualData.blocks.push(blockData);
        }

        // Fonction pour mettre à jour le compteur de caractères visuels - Logique améliorée
        function updateVisualCharCounter(textarea) {
            const length = textarea.value.length;
            const max = parseInt(textarea.dataset.max);
            const min = parseInt(textarea.dataset.min);
            const allowEmpty = textarea.dataset.allowEmpty === 'true';
            const counter = document.getElementById(`counter-${textarea.id}`);
            const checkbox = document.getElementById(`empty-${textarea.id}`);
            const isEmptyAllowed = checkbox && checkbox.checked;
            
            counter.textContent = `${length}/${max}`;
            
            // Colorier selon les seuils améliorés
            counter.className = 'char-counter';
            if (length > max) {
                counter.classList.add('danger');
            } else if (isEmptyAllowed && allowEmpty) {
                // Si "pas de texte" est coché et autorisé, toujours vert
                counter.classList.add('good');
            } else if (allowEmpty && length > 0 && length < 20) {
                // Pour les champs allowEmpty, minimum 20 caractères si on tape du texte
                counter.classList.add('danger');
            } else if (!allowEmpty && length < min) {
                // Pour les champs obligatoires, utiliser le min classique
                counter.classList.add('danger');
            } else {
                counter.classList.add('good');
            }

            // Mettre à jour les données
            const blockNumber = parseInt(textarea.closest('.visual-block').dataset.blockNumber);
            const fieldType = textarea.dataset.type;
            
            if (fieldType.startsWith('global-')) {
                // Champ global
                if (!visualData.globalFields) visualData.globalFields = {};
                visualData.globalFields[fieldType.replace('global-', '')] = textarea.value;
            } else {
                // Champ de bloc
                const blockData = visualData.blocks.find(b => b.number === blockNumber);
                if (blockData) {
                    blockData.fields[fieldType].value = textarea.value;
                }
            }
        }

        // Fonction pour mettre à jour le compteur de caractères du champ d'explication des visuels
        function updateExplanationCharCounter(textarea) {
            const length = textarea.value.length;
            const max = parseInt(textarea.dataset.max);
            const min = parseInt(textarea.dataset.min);
            const required = textarea.dataset.required === 'true';
            const counter = document.getElementById(`counter-${textarea.id}`);
            
            if (!counter) return;
            
            counter.textContent = `${length}/${max}`;
            
            // Colorier selon les règles spécifiées
            counter.className = 'char-counter';
            
            if (length > max) {
                // Toujours rouge si dépassement
                counter.classList.add('danger');
            } else if (!required) {
                // Si facultatif, toujours gris
                counter.classList.add('neutral');
            } else if (required && length < min) {
                // Si obligatoire et en dessous du minimum, rouge
                counter.classList.add('danger');
            } else if (required && length >= min) {
                // Si obligatoire et minimum atteint, vert
                counter.classList.add('good');
            }
            
            // Mettre à jour la validation
            updateModularVisualValidation();
        }

        // Fonction pour supprimer un bloc visuel
        function deleteVisualBlock(button) {
            const block = button.closest('.visual-block');
            const blockNumber = parseInt(block.dataset.blockNumber);
            
            // Supprimer du DOM
            block.remove();
            
            // Supprimer des données
            visualData.blocks = visualData.blocks.filter(b => b.number !== blockNumber);
            
            // Renuméroter les blocs
            renumberVisualBlocks();
            
            // Réafficher le bouton d'ajout si nécessaire
            const addButton = document.getElementById('btn-add-visual-slide');
            const config = getVisualConfig();
            if (config && visualData.blocks.length < config.maxBlocks) {
                addButton.style.display = 'block';
            }
            
            updateModularVisualValidation();
        }

        // Fonction pour renuméroter les blocs visuels
        function renumberVisualBlocks() {
            const blocks = document.querySelectorAll('.visual-block');
            blocks.forEach((block, index) => {
                const newNumber = index + 1;
                block.dataset.blockNumber = newNumber;
                
                const numberSpan = block.querySelector('.block-number');
                if (numberSpan) numberSpan.textContent = newNumber;
                
                // Mettre à jour les données
                if (visualData.blocks[index]) {
                    visualData.blocks[index].number = newNumber;
                }
            });
        }

        // Fonction de validation des visuels (retourne seulement les erreurs)
        function updateVisualValidation() {
            const config = getVisualConfig();
            let isValid = true;
            let errors = [];

            if (!config) {
                return { isValid: true, errors: [] };
            }

            // Vérifier le nombre minimum de blocs pour multi-blocs
            if (config.multiBlock && visualData.blocks.length < config.minBlocks) {
                isValid = false;
                errors.push(`Minimum ${config.minBlocks} descriptions visuelles requises`);
            }

            // Vérifier chaque bloc
            if (visualData.blocks) {
                visualData.blocks.forEach(block => {
                    Object.entries(block.fields).forEach(([fieldType, field]) => {
                        const length = field.value.length;
                        const fieldConfig = field.config;
                        
                        if (fieldConfig.required && length < fieldConfig.min) {
                            isValid = false;
                            errors.push(`Bloc ${block.number}: minimum ${fieldConfig.min} caractères requis`);
                        }
                        
                        if (length > fieldConfig.max) {
                            isValid = false;
                            errors.push(`Bloc ${block.number}: maximum ${fieldConfig.max} caractères dépassé`);
                        }
                    });
                });
            }

            // Vérifier les champs globaux s'ils existent
            if (config.globalFields) {
                Object.entries(config.globalFields).forEach(([fieldKey, fieldConfig]) => {
                    const textarea = document.querySelector(`[data-type="global-${fieldKey}"]`);
                    if (textarea) {
                        const length = textarea.value.length;
                        
                        if (fieldConfig.required && length < fieldConfig.min) {
                            isValid = false;
                            errors.push(`${fieldConfig.title}: minimum ${fieldConfig.min} caractères requis`);
                        }
                        
                        if (length > fieldConfig.max) {
                            isValid = false;
                            errors.push(`${fieldConfig.title}: maximum ${fieldConfig.max} caractères dépassé`);
                        }
                    }
                });
            }

            // Si le format n'est pas requis, toujours valide
            if (!config.required) {
                isValid = true;
                errors = [];
            }

            return { isValid, errors };
        }

        // Fonction pour configurer les événements d'upload
        function setupUploadEvents() {
            const dropzone = document.getElementById('dropzone');
            const fileInput = document.getElementById('file-input');
            const btnChooseFiles = document.querySelector('.btn-choose-files');
            const btnSkipVisual = document.getElementById('btn-skip-visual');
            
            // Événements dropzone
            dropzone.addEventListener('click', () => fileInput.click());
            btnChooseFiles.addEventListener('click', () => fileInput.click());
            
            dropzone.addEventListener('dragover', handleDragOver);
            dropzone.addEventListener('dragleave', handleDragLeave);
            dropzone.addEventListener('drop', handleDrop);
            
            fileInput.addEventListener('change', handleFileSelect);
            
            // Bouton ignorer visuels
            if (btnSkipVisual) {
                btnSkipVisual.addEventListener('click', function() {
                    showStep(5);
                    console.log('Passage à l\'étape 5 sans visuels');
                });
            }
        }

        // Gestion du drag & drop
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            processFiles(files);
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            processFiles(files);
        }

        // Traitement des fichiers
        function processFiles(files) {
            const config = getVisualConfig();
            const maxFiles = getRequiredImageCount();
            const uploadStatus = document.getElementById('upload-status');
            
            // Filtrer les fichiers images
            const imageFiles = files.filter(file => file.type.startsWith('image/') || file.type.startsWith('video/'));
            
            if (imageFiles.length === 0) {
                showUploadStatus('Veuillez sélectionner des fichiers image ou vidéo valides.', 'error');
                return;
            }
            
            // Vérifier le nombre de fichiers
            const totalFiles = visualData.images.length + imageFiles.length;
            if (totalFiles > maxFiles) {
                showUploadStatus(`Maximum ${maxFiles} fichier(s) autorisé(s) pour ce format.`, 'error');
                return;
            }
            
            // Traiter chaque fichier
            imageFiles.forEach(file => {
                if (visualData.images.length < maxFiles) {
                    addImageToGrid(file);
                }
            });
            
            showUploadStatus(`${imageFiles.length} fichier(s) ajouté(s) avec succès.`, 'success');
            updateModularVisualValidation();
        }

        // Ajouter une image à la grille
        function addImageToGrid(file) {
            const imagesGrid = document.getElementById('images-grid');
            const imageIndex = visualData.images.length;
            
            const imagePreview = document.createElement('div');
            imagePreview.className = 'image-preview';
            imagePreview.dataset.index = imageIndex;
            
            imagePreview.innerHTML = `
                <div class="image-header">
                    <span class="image-number">${imageIndex + 1}</span>
                    <div>
                        <span class="drag-handle">⋮⋮</span>
                        <button class="btn-remove-image" onclick="removeImage(${imageIndex})">✕</button>
                    </div>
                </div>
                <div class="image-placeholder">📷</div>
                <div class="image-info">${file.name}</div>
            `;
            
            imagesGrid.appendChild(imagePreview);
            
            // Stocker les données de l'image
            visualData.images.push({
                file: file,
                name: file.name,
                size: file.size,
                type: file.type
            });
            
            // Générer une preview si c'est une image
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const placeholder = imagePreview.querySelector('.image-placeholder');
                    placeholder.style.backgroundImage = `url(${e.target.result})`;
                    placeholder.style.backgroundSize = 'cover';
                    placeholder.style.backgroundPosition = 'center';
                    placeholder.textContent = '';
                };
                reader.readAsDataURL(file);
            }
        }

        // Supprimer une image
        function removeImage(index) {
            // Supprimer du DOM
            const imagePreview = document.querySelector(`[data-index="${index}"]`);
            if (imagePreview) {
                imagePreview.remove();
            }
            
            // Supprimer des données
            visualData.images.splice(index, 1);
            
            // Renuméroter les images restantes
            renumberImages();
            updateModularVisualValidation();
        }

        // Renuméroter les images
        function renumberImages() {
            const imagePreviews = document.querySelectorAll('.image-preview');
            imagePreviews.forEach((preview, index) => {
                preview.dataset.index = index;
                preview.querySelector('.image-number').textContent = index + 1;
                
                // Mettre à jour le bouton de suppression
                const removeBtn = preview.querySelector('.btn-remove-image');
                removeBtn.setAttribute('onclick', `removeImage(${index})`);
            });
        }

        // Afficher le statut d'upload
        function showUploadStatus(message, type = 'success') {
            const uploadStatus = document.getElementById('upload-status');
            uploadStatus.textContent = message;
            uploadStatus.className = `upload-status show ${type === 'error' ? 'error' : ''}`;
            
            // Masquer après 3 secondes
            setTimeout(() => {
                uploadStatus.classList.remove('show');
            }, 3000);
        }

        // Initialisation de l'étape 4 - Mise à jour pour le nouveau système
        function initStep4() {
            const btnRetour4 = document.getElementById('btn-retour-4');
            const btnSuivant4 = document.getElementById('btn-suivant-4');
            
            if (!btnRetour4 || !btnSuivant4) {
                return;
            }
            
            // Initialiser le système visuel modulaire
            initVisualStep();
            
            // Fonction pour le bouton retour
            function handleRetour() {
                showStep(3);
                visualData = { images: [], explanation: '', skipped: false };
            }
            
            // Fonction pour le bouton suivant
            function handleSuivant() {
                if (!btnSuivant4.disabled) {
                    showStep(5);
                    generateSummary();
                }
            }
            
            // Assigner les handlers avec onclick
            btnRetour4.onclick = handleRetour;
            btnSuivant4.onclick = handleSuivant;
        }

        // Fonction pour générer le résumé final
        function generateSummary() {
            // Récupérer les informations de la plateforme et du format
            const platformName = platformFormats[selectedPlatform]?.find(p => p.id === selectedPlatform)?.name || 
                                  selectedPlatform.charAt(0).toUpperCase() + selectedPlatform.slice(1);
            const formatName = platformFormats[selectedPlatform]?.find(f => f.id === selectedFormat)?.name || selectedFormat;
            
            // Configuration
            document.getElementById('summary-platform').textContent = platformName;
            document.getElementById('summary-format').textContent = formatName;
            
            const isMultiBlock = contentConfig[selectedFormat]?.multiBlock;
            document.getElementById('summary-type').textContent = isMultiBlock ? 'Multi-blocs' : 'Bloc unique';
            
            // Contenu
            const blocksCount = contentData.blocks ? contentData.blocks.length : 0;
            document.getElementById('summary-blocks-count').textContent = blocksCount;
            
            let totalChars = 0;
            let contentPreview = '';
            
            if (contentData.blocks) {
                contentData.blocks.forEach((block, index) => {
                    Object.entries(block.fields).forEach(([fieldType, field]) => {
                        totalChars += field.value.length;
                        if (field.value.trim() && contentPreview.length < 200) {
                            const preview = field.value.trim().substring(0, 100);
                            contentPreview += `${index + 1}. ${preview}${field.value.length > 100 ? '...' : ''}\n`;
                        }
                    });
                });
            }
            
            document.getElementById('summary-total-chars').textContent = totalChars;
            document.getElementById('content-preview').textContent = contentPreview || 'Aucun contenu saisi';
            
            // Statut du contenu
            const contentValid = validateContentForSummary();
            document.getElementById('summary-content-status').innerHTML = contentValid ? 
                '<span class="badge badge-success">✓ Valide</span>' : 
                '<span class="badge badge-warning">⚠ Incomplet</span>';
            
            // Visuels
            const imagesCount = visualData.images ? visualData.images.length : 0;
            const requiredImages = getRequiredImageCount();
            const visualConfig_ = getVisualConfig();
            
            document.getElementById('summary-images-count').textContent = imagesCount;
            document.getElementById('summary-images-required').textContent = 
                visualConfig_?.required ? requiredImages : 'Aucune';
            
            // Statut visuel
            const visualValid = validateVisualForSummary();
            document.getElementById('summary-visual-status').innerHTML = visualValid ? 
                '<span class="badge badge-success">✓ Conforme</span>' : 
                '<span class="badge badge-info">ℹ Optionnel</span>';
            
            // Initialiser l'étape 5
            initStep5();
        }

        // Validation du contenu pour le résumé
        function validateContentForSummary() {
            if (!contentData.blocks || contentData.blocks.length === 0) return false;
            
            const config = contentConfig[selectedFormat];
            if (!config) return false;
            
            return contentData.blocks.every(block => {
                return Object.entries(block.fields).every(([fieldType, field]) => {
                    if (field.config.required) {
                        return field.value.length >= field.config.min && field.value.length <= field.config.max;
                    }
                    return field.value.length <= field.config.max;
                });
            });
        }

        // Validation des visuels pour le résumé
        function validateVisualForSummary() {
            const config = getVisualConfig();
            if (!config || !config.required) return true;
            
            const requiredCount = getRequiredImageCount();
            return visualData.images.length === requiredCount;
        }

        // Initialisation de l'étape 5
        function initStep5() {
            const btnRetour5 = document.getElementById('btn-retour-5');
            const btnAnalyze = document.getElementById('btn-analyze-post');
            const btnRestart = document.getElementById('btn-restart');
            
            // Fonction pour le bouton retour
            function handleRetour() {
                showStep(4);
            }
            
            // Fonction pour le bouton analyser
            function handleAnalyze() {
                analyzePost();
            }
            
            // Assigner les handlers avec onclick
            btnRetour5.onclick = handleRetour;
            btnAnalyze.onclick = handleAnalyze;
            
            // Bouton recommencer
            btnRestart.addEventListener('click', function() {
                restartSimulator();
            });
        }

        // Fonction d'analyse du post - NOUVEAU SYSTÈME INTÉGRÉ
        async function analyzePost() {
            const btnAnalyze = document.getElementById('btn-analyze-post');
            const analyzeText = document.getElementById('analyze-text');
            const resultsSection = document.getElementById('results-section');
            const resultsContent = document.getElementById('results-content');
            
            // Désactiver le bouton et afficher le spinner
            btnAnalyze.disabled = true;
            analyzeText.innerHTML = '<span class="loading-spinner"></span>Analyse en cours...';
            
            try {
                // Préparer les données pour l'API
                const postData = prepareAnalysisData();
                
                // Simulation d'étapes d'analyse en temps réel
                await simulateAnalysisSteps();
                
                // Appel à l'API PostMaster™
                const analysisResult = await callPostMasterAPI(postData);
                
                // Afficher les résultats avec animations
                await displayAnalysisResults(analysisResult);
                
                // Restaurer le bouton
                btnAnalyze.disabled = false;
                analyzeText.innerHTML = '✅ Analyse terminée';
                
            } catch (error) {
                console.error('Erreur d\'analyse:', error);
                btnAnalyze.disabled = false;
                analyzeText.innerHTML = '❌ Erreur d\'analyse';
                
                // Afficher les résultats simulés en cas d'erreur
                const fallbackResult = generateAdvancedAnalysisResult();
                await displayAnalysisResults(fallbackResult);
            }
        }
        
        // Préparer les données pour l'analyse
        function prepareAnalysisData() {
            // Construire le texte complet
            let fullText = '';
            if (contentData.blocks) {
                contentData.blocks.forEach(block => {
                    Object.entries(block.fields).forEach(([fieldType, field]) => {
                        if (field.value) {
                            fullText += field.value + ' ';
                        }
                    });
                });
            }
            
            return {
                platform: selectedPlatform,
                format: selectedFormat,
                text: fullText.trim(),
                images: visualData.images || [],
                metadata: {
                    contentBlocks: contentData.blocks?.length || 0,
                    hasImages: (visualData.images?.length || 0) > 0,
                    timestamp: new Date().toISOString()
                }
            };
        }
        
        // Simulation des étapes d'analyse
        async function simulateAnalysisSteps() {
            const steps = [
                'Analyse du contenu textuel...',
                'Évaluation des hashtags et mentions...',
                'Analyse de la structure et longueur...',
                'Vérification de l\'optimisation plateforme...',
                'Calcul du score de performance...',
                'Génération des recommandations...'
            ];
            
            for (let i = 0; i < steps.length; i++) {
                document.getElementById('analyze-text').innerHTML = 
                    `<span class="loading-spinner"></span>${steps[i]}`;
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }
        
        // Appel à l'API PostMaster™
        async function callPostMasterAPI(data) {
            // En production, ceci serait un vrai appel à votre API PHP
            /*
            const response = await fetch('postmaster_api.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });
            return await response.json();
            */
            
            // Pour la démo, génération d'une analyse avancée
            return generateAdvancedAnalysisResult(data);
        }

        // Génération du résultat d'analyse AVANCÉ - Système PostMaster™
        function generateAdvancedAnalysisResult(data = null) {
            // Simuler l'analyse avancée basée sur le système PostMaster™
            const analysis = simulatePostMasterAnalysis(data);
            return analysis;
        }
        
        // Simulation de l'analyse PostMaster™ avec scoring réaliste
        function simulatePostMasterAnalysis(data) {
            // Analyse du texte
            const textAnalysis = analyzeTextContent(data);
            const visualAnalysis = analyzeVisualContent(data);
            
            // Calcul des scores selon le système PostMaster™
            const textScore = calculateTextScore(textAnalysis);
            const visualScore = calculateVisualScore(visualAnalysis);
            const globalScore = calculateGlobalScore(textScore, visualScore);
            
            // Génération des recommandations
            const recommendations = generateSmartRecommendations(textAnalysis, visualAnalysis, globalScore);
            
            return {
                globalScore,
                textScore,
                visualScore,
                textAnalysis,
                visualAnalysis,
                recommendations
            };
        }
        
        // Génération du résultat d'analyse simulé (fallback)
        function generateAnalysisResult() {
            const platformName = selectedPlatform.charAt(0).toUpperCase() + selectedPlatform.slice(1);
            const formatName = platformFormats[selectedPlatform]?.find(f => f.id === selectedFormat)?.name;
            
            return `
                <h4 style="color: var(--orange-principal); margin-bottom: 1rem;">🎯 Analyse pour ${platformName} - ${formatName}</h4>
                
                <div style="margin-bottom: 1.5rem;">
                    <h5 style="color: var(--bleu-nuit); margin-bottom: 0.5rem;">📊 Score de performance estimé</h5>
                    <div style="background: linear-gradient(90deg, var(--orange-principal) 75%, var(--gris-clair) 25%); height: 8px; border-radius: 4px; margin-bottom: 0.5rem;"></div>
                    <p><strong>75/100</strong> - Très bon potentiel d'engagement</p>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <h5 style="color: var(--bleu-nuit); margin-bottom: 0.5rem;">✅ Points forts détectés</h5>
                    <ul style="margin-left: 1rem; color: var(--gris-neutre);">
                        <li>Contenu adapté à la plateforme ${platformName}</li>
                        <li>Longueur optimale pour maximiser l'engagement</li>
                        <li>Structure cohérente et bien organisée</li>
                        ${visualData.images.length > 0 ? '<li>Éléments visuels présents pour augmenter la visibilité</li>' : ''}
                    </ul>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <h5 style="color: var(--bleu-nuit); margin-bottom: 0.5rem;">🔧 Recommandations d'amélioration</h5>
                    <ul style="margin-left: 1rem; color: var(--gris-neutre);">
                        <li>Ajoutez 2-3 hashtags stratégiques pour améliorer la découvrabilité</li>
                        <li>Intégrez une question pour encourager les commentaires</li>
                        <li>Optimisez le timing de publication (17h-19h pour cette audience)</li>
                        ${selectedFormat === 'carrousel' ? '<li>Assurez-vous que la première slide accroche immédiatement</li>' : ''}
                    </ul>
                </div>
                
                <div style="background: rgba(255, 90, 0, 0.05); padding: 1rem; border-radius: 8px; border-left: 4px solid var(--orange-principal);">
                    <h5 style="color: var(--orange-principal); margin-bottom: 0.5rem;">💡 Conseil stratégique</h5>
                    <p style="margin: 0; color: var(--bleu-nuit);">
                        Pour maximiser l'impact de ce ${formatName.toLowerCase()}, publiez-le pendant les heures de forte activité de votre audience et engagez activement avec les premiers commentaires pour booster l'algorithme.
                    </p>
                </div>
            `;
        }
        
        // SYSTÈME D'ANALYSE AVANCÉ PostMaster™
        
        // Analyse du contenu textuel
        function analyzeTextContent(data) {
            const text = data?.text || '';
            const platform = selectedPlatform;
            const format = selectedFormat;
            
            return {
                length: text.length,
                hashtags: (text.match(/#\w+/g) || []).length,
                mentions: (text.match(/@\w+/g) || []).length,
                emojis: (text.match(/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F1E0}-\u{1F1FF}]/gu) || []).length,
                words: text.split(/\s+/).filter(word => word.length > 0).length,
                sentences: text.split(/[.!?]+/).filter(s => s.trim().length > 0).length,
                callToAction: detectCallToAction(text),
                sentiment: analyzeSentiment(text),
                readability: calculateReadability(text),
                keywordDensity: analyzeKeywords(text),
                platformOptimization: checkPlatformOptimization(text, platform, format)
            };
        }
        
        // Analyse du contenu visuel
        function analyzeVisualContent(data) {
            const images = data?.images || visualData.images || [];
            
            return {
                count: images.length,
                formats: images.map(img => img.type || 'image/jpeg'),
                totalSize: images.reduce((sum, img) => sum + (img.size || 0), 0),
                aspectRatios: images.map(() => Math.random() > 0.5 ? '16:9' : '1:1'), // Simulation
                qualityScore: Math.floor(Math.random() * 20) + 80, // 80-100
                brandConsistency: Math.floor(Math.random() * 15) + 85, // 85-100
                colorHarmony: Math.floor(Math.random() * 20) + 75, // 75-95
                visualImpact: Math.floor(Math.random() * 25) + 70 // 70-95
            };
        }
        
        // Calcul du score textuel (T1-T50)
        function calculateTextScore(analysis) {
            let score = 0;
            const criteria = [];
            
            // T1-T10: Critères de base (chaque critère = 2 points)
            if (analysis.length > 10) { score += 2; criteria.push({id: 'T1', name: 'Longueur minimale', status: 'passed', points: 2}); }
            if (analysis.hashtags > 0 && analysis.hashtags <= 10) { score += 2; criteria.push({id: 'T2', name: 'Hashtags optimisés', status: 'passed', points: 2}); }
            if (analysis.emojis >= 1) { score += 2; criteria.push({id: 'T3', name: 'Utilisation d\'émojis', status: 'passed', points: 2}); }
            if (analysis.callToAction) { score += 2; criteria.push({id: 'T4', name: 'Call-to-action présent', status: 'passed', points: 2}); }
            if (analysis.readability > 70) { score += 2; criteria.push({id: 'T5', name: 'Lisibilité élevée', status: 'passed', points: 2}); }
            
            // T11-T30: Critères avancés (chaque critère = 1 point)
            if (analysis.sentiment === 'positive') { score += 1; criteria.push({id: 'T11', name: 'Sentiment positif', status: 'passed', points: 1}); }
            if (analysis.words >= 5 && analysis.words <= 100) { score += 1; criteria.push({id: 'T12', name: 'Nombre de mots optimal', status: 'passed', points: 1}); }
            if (analysis.platformOptimization > 80) { score += 1; criteria.push({id: 'T13', name: 'Optimisé pour la plateforme', status: 'passed', points: 1}); }
            
            // T31-T50: Critères experts (chaque critère = 1 point)
            const expertScore = Math.floor(Math.random() * 10) + 8; // 8-18 points experts
            score += expertScore;
            
            return {
                total: Math.min(score, 50),
                percentage: Math.min(Math.round((score / 50) * 100), 100),
                criteria: criteria,
                breakdown: {
                    base: Math.min(criteria.filter(c => c.id.startsWith('T') && parseInt(c.id.slice(1)) <= 10).length * 2, 20),
                    advanced: Math.min(criteria.filter(c => c.id.startsWith('T') && parseInt(c.id.slice(1)) > 10 && parseInt(c.id.slice(1)) <= 30).length, 20),
                    expert: expertScore
                }
            };
        }
        
        // Calcul du score visuel (V1-V50)
        function calculateVisualScore(analysis) {
            if (analysis.count === 0) {
                return { total: 0, percentage: 0, criteria: [], breakdown: { base: 0, advanced: 0, expert: 0 } };
            }
            
            let score = 0;
            const criteria = [];
            
            // V1-V10: Critères visuels de base
            if (analysis.count > 0) { score += 3; criteria.push({id: 'V1', name: 'Visuels présents', status: 'passed', points: 3}); }
            if (analysis.qualityScore > 85) { score += 2; criteria.push({id: 'V2', name: 'Haute qualité', status: 'passed', points: 2}); }
            if (analysis.brandConsistency > 80) { score += 2; criteria.push({id: 'V3', name: 'Cohérence de marque', status: 'passed', points: 2}); }
            if (analysis.aspectRatios.includes('16:9') || analysis.aspectRatios.includes('1:1')) { 
                score += 2; criteria.push({id: 'V4', name: 'Format adapté', status: 'passed', points: 2}); 
            }
            
            // V11-V30: Critères avancés
            if (analysis.colorHarmony > 80) { score += 1; criteria.push({id: 'V11', name: 'Harmonie des couleurs', status: 'passed', points: 1}); }
            if (analysis.visualImpact > 85) { score += 1; criteria.push({id: 'V12', name: 'Impact visuel fort', status: 'passed', points: 1}); }
            
            // V31-V50: Critères experts
            const expertScore = Math.floor(Math.random() * 12) + 8; // 8-20 points experts
            score += expertScore;
            
            return {
                total: Math.min(score, 50),
                percentage: Math.min(Math.round((score / 50) * 100), 100),
                criteria: criteria,
                breakdown: {
                    base: criteria.filter(c => parseInt(c.id.slice(1)) <= 10).reduce((sum, c) => sum + c.points, 0),
                    advanced: criteria.filter(c => parseInt(c.id.slice(1)) > 10 && parseInt(c.id.slice(1)) <= 30).reduce((sum, c) => sum + c.points, 0),
                    expert: expertScore
                }
            };
        }
        
        // Calcul du score global selon les pondérations PostMaster™
        function calculateGlobalScore(textScore, visualScore) {
            // Pondérations selon le groupe de plateforme
            const weights = getPlatformWeights(selectedPlatform, selectedFormat);
            
            // Calcul des scores pondérés sur la base de 50 points max par catégorie
            const maxTextPoints = 50 * weights.text;
            const maxVisualPoints = 50 * weights.visual;
            
            // Score pondéré réel
            const weightedTextScore = textScore.total * weights.text;
            const weightedVisualScore = visualScore.total * weights.visual;
            const totalWeightedScore = weightedTextScore + weightedVisualScore;
            
            // Score global sur 100
            const maxPossibleScore = maxTextPoints + maxVisualPoints;
            const globalPercentage = Math.round((totalWeightedScore / maxPossibleScore) * 100);
            
            return {
                total: Math.round(totalWeightedScore),
                percentage: globalPercentage,
                grade: getGrade(globalPercentage),
                weights: weights,
                maxPossible: Math.round(maxPossibleScore),
                breakdown: {
                    text: { 
                        score: textScore.total, 
                        maxPoints: Math.round(maxTextPoints),
                        weighted: Math.round(weightedTextScore) 
                    },
                    visual: { 
                        score: visualScore.total, 
                        maxPoints: Math.round(maxVisualPoints),
                        weighted: Math.round(weightedVisualScore) 
                    }
                }
            };
        }
        
        // Obtenir les pondérations selon la plateforme et format (système de groupes PostMaster™)
        function getPlatformWeights(platform, format) {
            // Mapping exact du système PHP - groupes par plateforme/format
            const platformGroupMapping = {
                // GROUPE 1 - Short video (text: 0.5, visual: 0.5)
                'tiktok': {
                    'video': 1,
                    'multi-sequences': 1
                },
                'youtube': {
                    'short': 1
                },
                'instagram': {
                    'reel': 1
                },
                'facebook': {
                    'reel': 1
                },
                
                // GROUPE 2 - Image/carrousel créatif (text: 0.6, visual: 0.4)
                'instagram-groupe2': {
                    'publication': 2,
                    'carrousel': 2
                },
                'pinterest': {
                    'epingle': 2,
                    'epingle-idee': 2
                },
                'facebook-groupe2': {
                    'publication': 2
                },
                
                // GROUPE 3 - Professionnel/long format (text: 0.7, visual: 0.3)
                'linkedin': {
                    'publication': 3,
                    'document': 3,
                    'article': 3
                },
                
                // GROUPE 4 - Microblog/threads (text: 0.8, visual: 0.2)
                'twitter': {
                    'tweet': 4,
                    'thread': 4
                },
                'threads': {
                    'thread': 4
                },
                
                // GROUPE 5 - Stories éphémères (text: 0.4, visual: 0.6)
                'instagram-groupe5': {
                    'story': 5
                },
                'facebook-groupe5': {
                    'story': 5
                }
            };
            
            // Poids par groupe (exactement comme dans le PHP)
            const groupWeights = {
                1: { text: 0.5, visual: 0.5 }, // Short video
                2: { text: 0.6, visual: 0.4 }, // Image/carrousel
                3: { text: 0.7, visual: 0.3 }, // Pro/long format
                4: { text: 0.8, visual: 0.2 }, // Microblog/threads
                5: { text: 0.4, visual: 0.6 }  // Stories
            };
            
            // Déterminer le groupe selon la plateforme et le format
            let group = 2; // Défaut
            
            // Vérification pour Instagram (groupes multiples)
            if (platform === 'instagram') {
                if (format === 'reel') group = 1;
                else if (format === 'story') group = 5;
                else group = 2; // publication, carrousel
            }
            // Vérification pour Facebook (groupes multiples)
            else if (platform === 'facebook') {
                if (format === 'reel') group = 1;
                else if (format === 'story') group = 5;
                else group = 2; // publication
            }
            // Autres plateformes à groupe unique
            else if (platformGroupMapping[platform] && platformGroupMapping[platform][format]) {
                group = platformGroupMapping[platform][format];
            }
            
            return groupWeights[group];
        }
        
        // Attribution de grade
        function getGrade(percentage) {
            if (percentage >= 95) return { letter: 'A+', color: '#28a745', label: 'Exceptionnel' };
            if (percentage >= 90) return { letter: 'A', color: '#28a745', label: 'Excellent' };
            if (percentage >= 85) return { letter: 'A-', color: '#6bb649', label: 'Très bon' };
            if (percentage >= 80) return { letter: 'B+', color: '#9bc53d', label: 'Bon' };
            if (percentage >= 75) return { letter: 'B', color: '#ffc107', label: 'Correct' };
            if (percentage >= 70) return { letter: 'B-', color: '#fd7e14', label: 'Passable' };
            if (percentage >= 60) return { letter: 'C', color: '#dc3545', label: 'Insuffisant' };
            return { letter: 'D', color: '#6c757d', label: 'Très insuffisant' };
        }
        
        // Fonctions d'analyse détaillées
        function detectCallToAction(text) {
            const ctaPatterns = [
                /\b(cliquez?|clique)\b/i,
                /\b(découvrez?|découvre)\b/i,
                /\b(commandez?|commande)\b/i,
                /\b(achetez?|achète)\b/i,
                /\b(suivez?|suis)\b/i,
                /\b(partagez?|partage)\b/i,
                /\b(likez?|like)\b/i,
                /\b(commentez?|commente)\b/i,
                /\b(abonnez?|abonne)\b/i,
                /\b(inscrivez?|inscris)\b/i
            ];
            
            return ctaPatterns.some(pattern => pattern.test(text));
        }
        
        function analyzeSentiment(text) {
            const positiveWords = ['super', 'génial', 'fantastique', 'excellent', 'parfait', 'magnifique', 'incroyable', 'formidable'];
            const negativeWords = ['mauvais', 'horrible', 'terrible', 'nul', 'décevant', 'problème', 'erreur'];
            
            const words = text.toLowerCase().split(/\s+/);
            const positiveCount = words.filter(word => positiveWords.includes(word)).length;
            const negativeCount = words.filter(word => negativeWords.includes(word)).length;
            
            if (positiveCount > negativeCount) return 'positive';
            if (negativeCount > positiveCount) return 'negative';
            return 'neutral';
        }
        
        function calculateReadability(text) {
            if (!text || text.length === 0) return 0;
            
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0).length;
            const words = text.split(/\s+/).filter(word => word.length > 0).length;
            
            if (sentences === 0) return 0;
            
            const avgWordsPerSentence = words / sentences;
            
            // Score basé sur la simplicité (moins de mots par phrase = plus lisible)
            if (avgWordsPerSentence <= 15) return 95;
            if (avgWordsPerSentence <= 20) return 85;
            if (avgWordsPerSentence <= 25) return 75;
            if (avgWordsPerSentence <= 30) return 65;
            return 50;
        }
        
        function analyzeKeywords(text) {
            const words = text.toLowerCase().split(/\s+/).filter(word => word.length > 3);
            const wordCount = {};
            
            words.forEach(word => {
                wordCount[word] = (wordCount[word] || 0) + 1;
            });
            
            const totalWords = words.length;
            const topKeywords = Object.entries(wordCount)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5)
                .map(([word, count]) => ({
                    word,
                    count,
                    density: Math.round((count / totalWords) * 100)
                }));
            
            return topKeywords;
        }
        
        function checkPlatformOptimization(text, platform, format) {
            let score = 60; // Score de base
            
            // Règles spécifiques par plateforme
            switch (platform) {
                case 'instagram':
                    if (format === 'reel' && text.length <= 125) score += 20;
                    if (format === 'publication' && text.length <= 300) score += 15;
                    if ((text.match(/#\w+/g) || []).length >= 3) score += 10;
                    break;
                    
                case 'twitter':
                    if (text.length <= 280) score += 25;
                    if ((text.match(/#\w+/g) || []).length <= 2) score += 10;
                    break;
                    
                case 'linkedin':
                    if (text.length >= 150 && text.length <= 1000) score += 20;
                    if ((text.match(/#\w+/g) || []).length <= 5) score += 10;
                    break;
                    
                case 'tiktok':
                    if (text.length <= 100) score += 20;
                    if ((text.match(/#\w+/g) || []).length >= 3) score += 10;
                    break;
            }
            
            return Math.min(score, 100);
        }
        
        function generateSmartRecommendations(textAnalysis, visualAnalysis, globalScore) {
            const recommendations = [];
            
            // Recommandations basées sur le texte
            if (textAnalysis.hashtags === 0) {
                recommendations.push({
                    type: 'hashtags',
                    priority: 'high',
                    message: 'Ajoutez 3-5 hashtags pertinents pour améliorer la découvrabilité',
                    impact: '+15% de portée'
                });
            }
            
            if (textAnalysis.emojis === 0) {
                recommendations.push({
                    type: 'emojis',
                    priority: 'medium',
                    message: 'Intégrez 2-3 émojis pour humaniser votre contenu',
                    impact: '+8% d\'engagement'
                });
            }
            
            if (!textAnalysis.callToAction) {
                recommendations.push({
                    type: 'cta',
                    priority: 'high',
                    message: 'Ajoutez un appel à l\'action clair pour encourager l\'interaction',
                    impact: '+20% d\'interactions'
                });
            }
            
            // Recommandations basées sur les visuels
            if (visualAnalysis.count === 0 && selectedFormat !== 'tweet') {
                recommendations.push({
                    type: 'visual',
                    priority: 'high',
                    message: 'Ajoutez du contenu visuel pour augmenter l\'engagement',
                    impact: '+150% d\'engagement'
                });
            }
            
            if (visualAnalysis.qualityScore < 80) {
                recommendations.push({
                    type: 'quality',
                    priority: 'medium',
                    message: 'Améliorez la qualité de vos visuels (résolution, éclairage)',
                    impact: '+12% de temps de vue'
                });
            }
            
            // Recommandations basées sur la plateforme
            const platformRec = getPlatformSpecificRecommendations(selectedPlatform, selectedFormat, textAnalysis);
            recommendations.push(...platformRec);
            
            return recommendations.slice(0, 6); // Maximum 6 recommandations
        }
        
        function getPlatformSpecificRecommendations(platform, format, analysis) {
            const recommendations = [];
            
            switch (platform) {
                case 'instagram':
                    if (format === 'reel' && analysis.length > 125) {
                        recommendations.push({
                            type: 'length',
                            priority: 'medium',
                            message: 'Raccourcissez le texte à 125 caractères max pour les Reels',
                            impact: '+10% de visibilité'
                        });
                    }
                    break;
                    
                case 'linkedin':
                    if (analysis.length < 150) {
                        recommendations.push({
                            type: 'length',
                            priority: 'medium',
                            message: 'Développez votre contenu (150+ caractères) pour LinkedIn',
                            impact: '+15% d\'engagement professionnel'
                        });
                    }
                    break;
                    
                case 'twitter':
                    if (analysis.hashtags > 2) {
                        recommendations.push({
                            type: 'hashtags',
                            priority: 'low',
                            message: 'Limitez à 1-2 hashtags maximum sur Twitter',
                            impact: '+5% d\'engagement'
                        });
                    }
                    break;
            }
            
            return recommendations;
        }
        
        // Fonction d'affichage des résultats avec animations
        async function displayAnalysisResults(analysis) {
            const resultsSection = document.getElementById('results-section');
            const resultsContent = document.getElementById('results-content');
            
            // Générer le HTML des résultats avancés
            const html = generateAdvancedResultsHTML(analysis);
            
            resultsContent.innerHTML = html;
            resultsSection.classList.add('show');
            
            // Animation progressive des éléments
            await animateResults();
            
            // Scroll vers les résultats
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Animation des résultats
        async function animateResults() {
            const elements = [
                '.score-display',
                '.text-score-section',
                '.visual-score-section', 
                '.recommendations-section',
                '.criteria-breakdown'
            ];
            
            for (let i = 0; i < elements.length; i++) {
                const element = document.querySelector(elements[i]);
                if (element) {
                    element.style.opacity = '0';
                    element.style.transform = 'translateY(20px)';
                    
                    setTimeout(() => {
                        element.style.transition = 'all 0.4s ease';
                        element.style.opacity = '1';
                        element.style.transform = 'translateY(0)';
                    }, i * 200);
                }
                
            }
        }
        
        // Génération du HTML des résultats avancés - VERSION PREMIUM COMPLÈTE
        function generateAdvancedResultsHTML(analysis) {
            const platformName = selectedPlatform.charAt(0).toUpperCase() + selectedPlatform.slice(1);
            const formatName = platformFormats[selectedPlatform]?.find(f => f.id === selectedFormat)?.name;
            
            return `
                <div class="advanced-analysis-results">
                    <!-- En-tête de l'analyse -->
                    <div class="analysis-header" style="text-align: center; margin-bottom: 30px;">
                        <h3 style="color: var(--orange-principal); margin-bottom: 0.5rem; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 28px;">
                            🎯 Analyse PostMaster™ 
                            <span style="background: var(--orange-principal); color: white; padding: 4px 12px; border-radius: 20px; font-size: 14px; font-weight: normal;">PRO</span>
                        </h3>
                        <p style="color: var(--gris-neutre); margin: 0; font-size: 16px; font-weight: 500;">
                            ${platformName} • ${formatName} • Analysé avec l'IA GPT-4
                        </p>
                    </div>

                    <!-- Score global avec design premium -->
                    <div class="score-display" style="background: linear-gradient(135deg, #ff5a00 0%, #ff8f00 100%); padding: 40px; border-radius: 20px; color: white; text-align: center; margin: 30px 0; box-shadow: 0 12px 40px rgba(255, 90, 0, 0.4); position: relative; overflow: hidden;">
                        <div style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);"></div>
                        <div style="position: relative; z-index: 2;">
                            <div style="display: flex; align-items: center; justify-content: center; gap: 30px; flex-wrap: wrap;">
                                <div class="score-circle" style="width: 120px; height: 120px; border-radius: 50%; background: rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; position: relative; backdrop-filter: blur(10px);">
                                    <svg width="120" height="120" style="position: absolute; transform: rotate(-90deg);">
                                        <circle cx="60" cy="60" r="50" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="8"/>
                                        <circle cx="60" cy="60" r="50" fill="none" stroke="white" stroke-width="8" 
                                                stroke-dasharray="${2 * Math.PI * 50}" 
                                                stroke-dashoffset="${2 * Math.PI * 50 * (1 - analysis.globalScore.percentage / 100)}"
                                                style="transition: stroke-dashoffset 3s ease; stroke-linecap: round;"/>
                                    </svg>
                                    <div style="font-size: 32px; font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">${analysis.globalScore.percentage}</div>
                                </div>
                                <div style="text-align: left;">
                                    <div style="font-size: 48px; font-weight: 800; margin-bottom: 8px; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
                                        ${analysis.globalScore.grade.letter}
                                    </div>
                                    <div style="font-size: 20px; opacity: 0.95; margin-bottom: 12px; font-weight: 600;">
                                        ${analysis.globalScore.grade.label}
                                    </div>
                                    <div style="font-size: 16px; opacity: 0.9; background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 15px; backdrop-filter: blur(5px);">
                                        Score global: ${analysis.globalScore.total}/${analysis.globalScore.maxPossible}
                                    </div>
                                </div>
                            </div>
                            <div style="margin-top: 25px; padding-top: 25px; border-top: 1px solid rgba(255,255,255,0.4);">
                                <div style="display: flex; justify-content: space-around; font-size: 16px; font-weight: 600;">
                                    <div style="text-align: center;">
                                        <div style="opacity: 0.9;">Contenu Textuel</div>
                                        <div style="font-size: 20px; margin-top: 5px;">${analysis.textScore.percentage}%</div>
                                        <div style="font-size: 12px; opacity: 0.8;">Poids: ${Math.round(analysis.globalScore.weights.text * 100)}%</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="opacity: 0.9;">Contenu Visuel</div>
                                        <div style="font-size: 20px; margin-top: 5px;">${analysis.visualScore.percentage}%</div>
                                        <div style="font-size: 12px; opacity: 0.8;">Poids: ${Math.round(analysis.globalScore.weights.visual * 100)}%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Scores détaillés avec nouveau design -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin: 30px 0;">
                        <!-- Score Texte -->
                        <div class="text-score-section" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border: 2px solid #2196f3; border-radius: 16px; padding: 25px; position: relative; overflow: hidden;">
                            <div style="position: absolute; top: -20px; right: -20px; width: 60px; height: 60px; background: rgba(33, 150, 243, 0.1); border-radius: 50%;"></div>
                            <h4 style="color: var(--bleu-nuit); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; font-size: 18px; position: relative; z-index: 2;">
                                📝 Analyse Textuelle
                                <span style="background: #2196f3; color: white; padding: 4px 8px; border-radius: 10px; font-size: 12px; font-weight: 600;">T1-T50</span>
                            </h4>
                            <div style="margin-bottom: 20px; position: relative; z-index: 2;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-weight: 600;">
                                    <span style="font-size: 16px;">${analysis.textScore.total}/${Math.round(50 * analysis.globalScore.weights.text)} points</span>
                                    <span style="color: #2196f3; font-size: 20px; font-weight: 700;">${analysis.textScore.percentage}%</span>
                                </div>
                                <div style="background: rgba(255,255,255,0.7); height: 12px; border-radius: 6px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
                                    <div style="background: linear-gradient(90deg, #2196f3, #1976d2); height: 100%; width: ${analysis.textScore.percentage}%; transition: width 3s ease; border-radius: 6px; box-shadow: 0 2px 8px rgba(33, 150, 243, 0.4);"></div>
                                </div>
                            </div>
                            <div style="font-size: 14px; color: var(--gris-neutre); position: relative; z-index: 2;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding: 8px 12px; background: rgba(255,255,255,0.6); border-radius: 8px;">
                                    <span>✅ Base (T1-T10):</span>
                                    <span style="font-weight: 600; color: #2196f3;">${analysis.textScore.breakdown.base}/${Math.round(20 * analysis.globalScore.weights.text)} pts</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding: 8px 12px; background: rgba(255,255,255,0.6); border-radius: 8px;">
                                    <span>🔬 Avancé (T11-T30):</span>
                                    <span style="font-weight: 600; color: #2196f3;">${analysis.textScore.breakdown.advanced}/${Math.round(20 * analysis.globalScore.weights.text)} pts</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: rgba(255,255,255,0.6); border-radius: 8px;">
                                    <span>🎯 Expert (T31-T50):</span>
                                    <span style="font-weight: 600; color: #2196f3;">${analysis.textScore.breakdown.expert}/${Math.round(10 * analysis.globalScore.weights.text)} pts</span>
                                </div>
                            </div>
                        </div>

                        <!-- Score Visuel -->
                        <div class="visual-score-section" style="background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); border: 2px solid #9c27b0; border-radius: 16px; padding: 25px; position: relative; overflow: hidden;">
                            <div style="position: absolute; top: -20px; right: -20px; width: 60px; height: 60px; background: rgba(156, 39, 176, 0.1); border-radius: 50%;"></div>
                            <h4 style="color: #7b1fa2; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; font-size: 18px; position: relative; z-index: 2;">
                                🎨 Analyse Visuelle
                                <span style="background: #9c27b0; color: white; padding: 4px 8px; border-radius: 10px; font-size: 12px; font-weight: 600;">V1-V50</span>
                            </h4>
                            <div style="margin-bottom: 20px; position: relative; z-index: 2;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-weight: 600;">
                                    <span style="font-size: 16px;">${analysis.visualScore.total}/${Math.round(50 * analysis.globalScore.weights.visual)} points</span>
                                    <span style="color: #9c27b0; font-size: 20px; font-weight: 700;">${analysis.visualScore.percentage}%</span>
                                </div>
                                <div style="background: rgba(255,255,255,0.7); height: 12px; border-radius: 6px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
                                    <div style="background: linear-gradient(90deg, #9c27b0, #7b1fa2); height: 100%; width: ${analysis.visualScore.percentage}%; transition: width 3s ease; border-radius: 6px; box-shadow: 0 2px 8px rgba(156, 39, 176, 0.4);"></div>
                                </div>
                            </div>
                            <div style="font-size: 14px; color: var(--gris-neutre); position: relative; z-index: 2;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding: 8px 12px; background: rgba(255,255,255,0.6); border-radius: 8px;">
                                    <span>✅ Base (V1-V10):</span>
                                    <span style="font-weight: 600; color: #9c27b0;">${analysis.visualScore.breakdown.base}/${Math.round(20 * analysis.globalScore.weights.visual)} pts</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding: 8px 12px; background: rgba(255,255,255,0.6); border-radius: 8px;">
                                    <span>🔬 Avancé (V11-V30):</span>
                                    <span style="font-weight: 600; color: #9c27b0;">${analysis.visualScore.breakdown.advanced}/${Math.round(20 * analysis.globalScore.weights.visual)} pts</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: rgba(255,255,255,0.6); border-radius: 8px;">
                                    <span>🎯 Expert (V31-V50):</span>
                                    <span style="font-weight: 600; color: #9c27b0;">${analysis.visualScore.breakdown.expert}/${Math.round(10 * analysis.globalScore.weights.visual)} pts</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recommandations premium -->
                    <div class="recommendations-section" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 16px; padding: 30px; margin: 30px 0; border: 1px solid #dee2e6; box-shadow: 0 8px 24px rgba(0,0,0,0.08);">
                        <h4 style="color: var(--orange-principal); margin-bottom: 25px; display: flex; align-items: center; gap: 10px; font-size: 22px;">
                            💡 Recommandations Intelligentes
                            <span style="background: var(--orange-principal); color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600;">IA</span>
                        </h4>
                        <div style="display: grid; gap: 16px;">
                            ${analysis.recommendations.map((rec, index) => `
                                <div style="background: white; border-left: 6px solid ${rec.priority === 'high' ? '#dc3545' : rec.priority === 'medium' ? '#ffc107' : '#28a745'}; padding: 20px; border-radius: 0 12px 12px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.08); transition: transform 0.2s ease, box-shadow 0.2s ease; position: relative; overflow: hidden;" 
                                     onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.12)'" 
                                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.08)'">
                                    <div style="position: absolute; top: 0; right: 0; width: 60px; height: 60px; background: ${rec.priority === 'high' ? 'rgba(220, 53, 69, 0.05)' : rec.priority === 'medium' ? 'rgba(255, 193, 7, 0.05)' : 'rgba(40, 167, 69, 0.05)'}; border-radius: 0 12px 0 60px;"></div>
                                    <div style="position: relative; z-index: 2;">
                                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                            <span style="background: ${rec.priority === 'high' ? '#dc3545' : rec.priority === 'medium' ? '#ffc107' : '#28a745'}; color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">
                                                ${rec.priority === 'high' ? '🔥 Critique' : rec.priority === 'medium' ? '⚡ Important' : '💚 Bonus'}
                                            </span>
                                            <span style="color: var(--gris-neutre); font-size: 13px; text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px; opacity: 0.8;">${rec.type}</span>
                                        </div>
                                        <p style="margin: 12px 0; color: var(--bleu-nuit); font-weight: 600; line-height: 1.5; font-size: 15px;">${rec.message}</p>
                                        <div style="display: flex; align-items: center; gap: 8px; background: rgba(40, 167, 69, 0.1); padding: 8px 12px; border-radius: 20px; display: inline-flex;">
                                            <span style="font-size: 16px;">📈</span>
                                            <span style="color: #28a745; font-size: 14px; font-weight: 700;">Impact estimé: ${rec.impact}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Call to action premium -->
                    <div style="background: linear-gradient(135deg, var(--orange-principal) 0%, #ff8f00 100%); color: white; padding: 35px; border-radius: 20px; text-align: center; margin: 30px 0; position: relative; overflow: hidden; box-shadow: 0 12px 40px rgba(255, 90, 0, 0.3);">
                        <div style="position: relative; z-index: 2;">
                            <h4 style="margin-bottom: 18px; font-size: 24px; font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">🚀 Optimisez encore plus avec PostMaster™ Pro</h4>
                            <p style="margin-bottom: 25px; opacity: 0.95; line-height: 1.6; font-size: 16px; max-width: 600px; margin-left: auto; margin-right: auto;">
                                Analysez automatiquement tous vos posts, obtenez des recommandations en temps réel avec GPT-4, 
                                et suivez vos performances avec notre système d'IA avancée.
                            </p>
                            <button style="background: white; color: var(--orange-principal); border: none; padding: 15px 35px; border-radius: 30px; font-weight: 700; cursor: pointer; font-size: 18px; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2);" 
                                    onmouseover="this.style.transform='scale(1.05) translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.3)'" 
                                    onmouseout="this.style.transform='scale(1) translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)'">
                                ✨ Découvrir PostMaster™ Pro
                            </button>
                            <div style="margin-top: 20px; font-size: 14px; opacity: 0.9;">
                                🔥 Plus de 1000+ créateurs nous font confiance
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Fonction pour redémarrer le simulateur
        function restartSimulator() {
            // Réinitialiser toutes les variables
            currentStep = 1;
            selectedPlatform = null;
            selectedFormat = null;
            contentData = {};
            visualData = { images: [], required: false };
            
            // Nettoyer les interfaces
            document.getElementById('formats-container').innerHTML = '';
            document.getElementById('content-blocks-container').innerHTML = '';
            document.getElementById('images-grid').innerHTML = '';
            document.getElementById('results-section').classList.remove('show');
            
            // Réinitialiser les boutons
            document.querySelectorAll('.platform-card').forEach(card => card.classList.remove('selected'));
            document.getElementById('btn-suivant-1').disabled = true;
            
            // Restaurer le bouton d'analyse
            const btnAnalyze = document.getElementById('btn-analyze-post');
            const analyzeText = document.getElementById('analyze-text');
            btnAnalyze.disabled = false;
            analyzeText.innerHTML = '🚀 Analyser mon post';
            
            // Retourner à l'étape 1
            showStep(1);
        }

        // Fonction sendToAI pour future intégration PHP
        function sendToAI() {
            // Cette fonction sera utilisée pour l'intégration future avec l'IA
            const postData = {
                platform: selectedPlatform,
                format: selectedFormat,
                content: contentData,
                visuals: visualData,
                timestamp: new Date().toISOString()
            };
            
            console.log('Données à envoyer à l\'IA:', postData);
            
            // Ici vous pourrez ajouter l'appel Ajax vers votre backend PHP
            // fetch('/api/analyze-post', {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify(postData)
            // });
            
            return postData;
        }
        
        // Fonction pour mettre à jour la frise de progression
        function updateFrise(stepNumber) {
            const totalSteps = 5;
            
            // Calculer la largeur basée sur la position dans la grille
            // Chaque étape représente 1/(totalSteps-1) de la largeur totale disponible
            let progressRatio = 0;
            if (stepNumber > 1) {
                // La barre va de 0 à (stepNumber-1)/(totalSteps-1)
                progressRatio = (stepNumber - 1) / (totalSteps - 1);
            }
            
            // Mettre à jour la ligne de progression avec CSS custom property
            const frise = document.getElementById('frise');
            frise.style.setProperty('--progress-ratio', progressRatio);
            
            // Mettre à jour les cercles et labels
            for (let i = 1; i <= totalSteps; i++) {
                const circle = document.getElementById(`circle-${i}`);
                const label = circle.nextElementSibling;
                
                if (i < stepNumber) {
                    // Étape terminée
                    circle.className = 'step-circle completed';
                    circle.innerHTML = '✓';
                    label.className = 'step-label completed';
                } else if (i === stepNumber) {
                    // Étape actuelle
                    circle.className = 'step-circle active';
                    circle.innerHTML = i;
                    label.className = 'step-label active';
                } else {
                    // Étape future
                    circle.className = 'step-circle inactive';
                    circle.innerHTML = i;
                    label.className = 'step-label inactive';
                }
            }
        }

        // Fonction pour afficher une étape
        function showStep(stepNumber) {
            // Masquer toutes les étapes
            const allSteps = document.querySelectorAll('.step-content');
            allSteps.forEach(step => step.classList.remove('active'));
            
            // Afficher l'étape demandée
            const targetStep = document.getElementById(`step-${stepNumber}`);
            if (targetStep) {
                targetStep.classList.add('active');
            }
            
            // Mettre à jour la frise
            updateFrise(stepNumber);
            currentStep = stepNumber;
            
            // Initialiser les boutons de l'étape
            if (stepNumber === 2) {
                initStep2();
            } else if (stepNumber === 3) {
                initStep3();
            } else if (stepNumber === 4) {
                initStep4();
            } else if (stepNumber === 5) {
                initStep5();
            }
            
            // Défilement fluide vers le haut de la page
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });

            // Mettre à jour les rappels de sélection
            updateSelectionReminder(stepNumber);
        }

        // Données des plateformes pour le rappel
        const platformData = {
            facebook: { 
                name: 'Facebook', 
                html: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>' 
            },
            instagram: { 
                name: 'Instagram', 
                html: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>' 
            },
            tiktok: { 
                name: 'TikTok', 
                html: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/></svg>' 
            },
            youtube: { 
                name: 'YouTube', 
                html: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>' 
            },
            linkedin: { 
                name: 'LinkedIn', 
                html: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>' 
            },
            twitter: { 
                name: 'X (Twitter)', 
                html: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>' 
            },
            threads: { 
                name: 'Threads', 
                html: '<img src="threads.avif" alt="Threads" style="width: 20px; height: 20px; object-fit: contain;">' 
            },
            pinterest: { 
                name: 'Pinterest', 
                html: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.174-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.347-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.402.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.357-.629-2.746-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24.009 12.017 24c6.624 0 11.99-5.367 11.99-12C24.007 5.367 18.641.001.017 0z"/></svg>' 
            }
        };

        // Fonction pour générer les icônes SVG des formats
        function generateFormatIcon(type) {
            const icons = {
                // 1. Icône Vidéo verticale courte (9:16 avec play button)
                reel: `<svg viewBox="0 0 24 24" class="video-vertical-icon" fill="currentColor">
                    <rect x="7" y="2" width="10" height="20" rx="3" ry="3" fill="currentColor"/>
                    <circle cx="12" cy="12" r="4" fill="none" stroke="white" stroke-width="1.5" opacity="0.3"/>
                    <polygon points="10,9 10,15 15,12" fill="white"/>
                    <rect x="8" y="18" width="8" height="1" rx="0.5" fill="white" opacity="0.7"/>
                </svg>`,

                video: `<svg viewBox="0 0 24 24" class="video-vertical-icon" fill="currentColor">
                    <rect x="7" y="2" width="10" height="20" rx="3" ry="3" fill="currentColor"/>
                    <circle cx="12" cy="12" r="4" fill="none" stroke="white" stroke-width="1.5" opacity="0.3"/>
                    <polygon points="10,9 10,15 15,12" fill="white"/>
                    <rect x="8" y="18" width="8" height="1" rx="0.5" fill="white" opacity="0.7"/>
                </svg>`,

                short: `<svg viewBox="0 0 24 24" class="video-vertical-icon" fill="currentColor">
                    <rect x="7" y="2" width="10" height="20" rx="3" ry="3" fill="currentColor"/>
                    <rect x="8" y="4" width="8" height="2" rx="1" fill="#FF0000"/>
                    <circle cx="12" cy="12" r="4" fill="none" stroke="white" stroke-width="1.5" opacity="0.4"/>
                    <polygon points="10,9 10,15 15,12" fill="white"/>
                    <rect x="9" y="18" width="6" height="1.5" rx="0.75" fill="white" opacity="0.7"/>
                </svg>`,

                // 2. Icône Carrousel / multi-slide (rectangles superposés)
                carrousel: `<svg viewBox="0 0 24 24" class="carrousel-icon" fill="currentColor">
                    <rect x="2" y="6" width="16" height="12" rx="2" fill="currentColor" opacity="0.4"/>
                    <rect x="4" y="4" width="16" height="12" rx="2" fill="currentColor" opacity="0.7"/>
                    <rect x="6" y="2" width="16" height="12" rx="2" fill="currentColor"/>
                    <rect x="8" y="4" width="6" height="4" rx="1" fill="white" opacity="0.8"/>
                    <rect x="8" y="9" width="10" height="1" rx="0.5" fill="white" opacity="0.6"/>
                    <rect x="8" y="11" width="8" height="1" rx="0.5" fill="white" opacity="0.4"/>
                    <circle cx="20" cy="5" r="1" fill="white"/>
                    <circle cx="20" cy="7" r="0.5" fill="white" opacity="0.6"/>
                    <circle cx="20" cy="8.5" r="0.5" fill="white" opacity="0.4"/>
                </svg>`,

                'multi-sequences': `<svg viewBox="0 0 24 24" class="carrousel-icon" fill="currentColor">
                    <rect x="2" y="6" width="16" height="12" rx="2" fill="currentColor" opacity="0.4"/>
                    <rect x="4" y="4" width="16" height="12" rx="2" fill="currentColor" opacity="0.7"/>
                    <rect x="6" y="2" width="16" height="12" rx="2" fill="currentColor"/>
                    <rect x="8" y="4" width="6" height="4" rx="1" fill="white" opacity="0.8"/>
                    <rect x="8" y="9" width="10" height="1" rx="0.5" fill="white" opacity="0.6"/>
                    <rect x="8" y="11" width="8" height="1" rx="0.5" fill="white" opacity="0.4"/>
                    <circle cx="20" cy="5" r="1" fill="white"/>
                    <circle cx="20" cy="7" r="0.5" fill="white" opacity="0.6"/>
                    <circle cx="20" cy="8.5" r="0.5" fill="white" opacity="0.4"/>
                </svg>`,

                // 3. Icône Story éphémère (smartphone avec cercle)
                story: `<svg viewBox="0 0 24 24" class="story-icon" fill="currentColor">
                    <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
                    <circle cx="12" cy="12" r="8" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="3,1"/>
                    <rect x="8" y="6" width="8" height="12" rx="2" fill="currentColor"/>
                    <rect x="9" y="8" width="6" height="4" rx="1" fill="white" opacity="0.8"/>
                    <rect x="9" y="13" width="4" height="1" rx="0.5" fill="white" opacity="0.6"/>
                    <rect x="9" y="15" width="5" height="1" rx="0.5" fill="white" opacity="0.4"/>
                    <circle cx="12" cy="4" r="1" fill="currentColor"/>
                    <path d="M10 2 L11 4 L13 4 L14 2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>`,

                // 4. Icône Post image + texte (carré avec image + lignes)
                publication: `<svg viewBox="0 0 24 24" class="post-image-icon" fill="currentColor">
                    <rect x="2" y="2" width="20" height="20" rx="3" fill="currentColor"/>
                    <rect x="4" y="4" width="16" height="8" rx="2" fill="white" opacity="0.9"/>
                    <circle cx="8" cy="8" r="1.5" fill="currentColor" opacity="0.6"/>
                    <polygon points="12,10 14,8 16,9 18,7 20,8 20,11 4,11" fill="currentColor" opacity="0.3"/>
                    <rect x="4" y="14" width="12" height="1.5" rx="0.75" fill="white" opacity="0.8"/>
                    <rect x="4" y="16.5" width="16" height="1.5" rx="0.75" fill="white" opacity="0.6"/>
                    <rect x="4" y="19" width="10" height="1.5" rx="0.75" fill="white" opacity="0.4"/>
                </svg>`,

                // 5. Icône Post texte seul (page avec lignes + avatar)
                tweet: `<svg viewBox="0 0 24 24" class="post-text-icon" fill="currentColor">
                    <rect x="3" y="2" width="18" height="20" rx="3" fill="currentColor"/>
                    <circle cx="8" cy="6" r="2" fill="white"/>
                    <rect x="11" y="5" width="8" height="1.5" rx="0.75" fill="white" opacity="0.8"/>
                    <rect x="11" y="7.5" width="6" height="1" rx="0.5" fill="white" opacity="0.6"/>
                    <rect x="4" y="11" width="16" height="1.5" rx="0.75" fill="white" opacity="0.7"/>
                    <rect x="4" y="13.5" width="14" height="1.5" rx="0.75" fill="white" opacity="0.6"/>
                    <rect x="4" y="16" width="12" height="1.5" rx="0.75" fill="white" opacity="0.5"/>
                    <rect x="4" y="18.5" width="8" height="1.5" rx="0.75" fill="white" opacity="0.4"/>
                </svg>`,

                // 6. Icône Thread (bulles empilées avec trait)
                thread: `<svg viewBox="0 0 24 24" class="thread-icon" fill="currentColor">
                    <rect x="2" y="2" width="14" height="6" rx="3" fill="currentColor" opacity="0.6"/>
                    <rect x="4" y="8" width="16" height="6" rx="3" fill="currentColor" opacity="0.8"/>
                    <rect x="6" y="14" width="18" height="6" rx="3" fill="currentColor"/>
                    <line x1="9" y1="8" x2="12" y2="8" stroke="white" stroke-width="2" opacity="0.7"/>
                    <line x1="12" y1="14" x2="15" y2="14" stroke="white" stroke-width="2" opacity="0.7"/>
                    <circle cx="6" cy="5" r="1.5" fill="white"/>
                    <circle cx="10" cy="11" r="1.5" fill="white"/>
                    <circle cx="14" cy="17" r="1.5" fill="white"/>
                    <rect x="9" y="4" width="5" height="1" rx="0.5" fill="white" opacity="0.8"/>
                    <rect x="13" y="10" width="6" height="1" rx="0.5" fill="white" opacity="0.8"/>
                    <rect x="17" y="16" width="4" height="1" rx="0.5" fill="white" opacity="0.8"/>
                </svg>`,

                // 7. Icône Article (document A4 avec coin + stylo)
                article: `<svg viewBox="0 0 24 24" class="article-icon" fill="currentColor">
                    <rect x="4" y="2" width="14" height="20" rx="2" fill="currentColor"/>
                    <path d="M16 2 L18 4 L18 7 L16 7 Z" fill="white"/>
                    <rect x="6" y="6" width="10" height="2" rx="1" fill="white" opacity="0.9"/>
                    <rect x="6" y="9" width="8" height="1" rx="0.5" fill="white" opacity="0.7"/>
                    <rect x="6" y="11" width="9" height="1" rx="0.5" fill="white" opacity="0.6"/>
                    <rect x="6" y="13" width="7" height="1" rx="0.5" fill="white" opacity="0.5"/>
                    <rect x="6" y="15" width="8" height="1" rx="0.5" fill="white" opacity="0.4"/>
                    <rect x="6" y="17" width="6" height="1" rx="0.5" fill="white" opacity="0.3"/>
                    <circle cx="16" cy="18" r="2.5" fill="#0077B5"/>
                    <path d="M14.5 17 L15.5 18 L17.5 16" stroke="white" stroke-width="1.5" fill="none"/>
                    <path d="M17 14 L19 15 L18 17 L16 16 Z" fill="#0077B5" opacity="0.7"/>
                </svg>`,

                // 8. Icône Document PDF (documents empilés)
                document: `<svg viewBox="0 0 24 24" class="document-icon" fill="currentColor">
                    <rect x="3" y="4" width="14" height="18" rx="2" fill="currentColor" opacity="0.5"/>
                    <rect x="5" y="2" width="14" height="18" rx="2" fill="currentColor"/>
                    <path d="M17 2 L19 4 L19 6 L17 6 Z" fill="white"/>
                    <rect x="7" y="6" width="8" height="1.5" rx="0.75" fill="white" opacity="0.8"/>
                    <rect x="7" y="8.5" width="6" height="1" rx="0.5" fill="white" opacity="0.6"/>
                    <rect x="7" y="10.5" width="7" height="1" rx="0.5" fill="white" opacity="0.5"/>
                    <rect x="7" y="12.5" width="5" height="1" rx="0.5" fill="white" opacity="0.4"/>
                    <rect x="6" y="15" width="8" height="3" rx="1.5" stroke="#0077B5" stroke-width="2" fill="white"/>
                    <text x="10" y="17" text-anchor="middle" font-size="3" fill="#0077B5" font-weight="bold">PDF</text>
                </svg>`,

                // 9. Icône Épingle Pinterest (punaise avec cadre)
                epingle: `<svg viewBox="0 0 24 24" class="pinterest-icon" fill="currentColor">
                    <rect x="6" y="4" width="12" height="16" rx="3" fill="currentColor"/>
                    <rect x="7" y="6" width="10" height="8" rx="2" fill="white" opacity="0.9"/>
                    <rect x="8" y="7" width="8" height="3" rx="1" fill="currentColor" opacity="0.6"/>
                    <rect x="8" y="11" width="6" height="1" rx="0.5" fill="currentColor" opacity="0.4"/>
                    <rect x="8" y="13" width="7" height="1" rx="0.5" fill="currentColor" opacity="0.3"/>
                    <circle cx="12" cy="16.5" r="1.5" fill="#E60023"/>
                    <path d="M12 20 L10 22 L12 22.5 L14 22 Z" fill="currentColor"/>
                    <circle cx="12" cy="2" r="1.5" fill="currentColor"/>
                    <rect x="11" y="3" width="2" height="1" rx="1" fill="currentColor"/>
                </svg>`,

                'epingle-idee': `<svg viewBox="0 0 24 24" class="pinterest-icon" fill="currentColor">
                    <rect x="4" y="2" width="16" height="20" rx="3" fill="currentColor"/>
                    <circle cx="8" cy="6" r="1.5" fill="white"/>
                    <rect x="10" y="5.5" width="8" height="1" rx="0.5" fill="white"/>
                    <circle cx="8" cy="10" r="1.5" fill="white"/>
                    <rect x="10" y="9.5" width="6" height="1" rx="0.5" fill="white"/>
                    <circle cx="8" cy="14" r="1.5" fill="white"/>
                    <rect x="10" y="13.5" width="8" height="1" rx="0.5" fill="white"/>
                    <circle cx="8" cy="18" r="1.5" fill="white"/>
                    <rect x="10" y="17.5" width="4" height="1" rx="0.5" fill="white"/>
                    <text x="8" y="6.7" text-anchor="middle" font-size="1.2" fill="currentColor" font-weight="bold">1</text>
                    <text x="8" y="10.7" text-anchor="middle" font-size="1.2" fill="currentColor" font-weight="bold">2</text>
                    <text x="8" y="14.7" text-anchor="middle" font-size="1.2" fill="currentColor" font-weight="bold">3</text>
                    <text x="8" y="18.7" text-anchor="middle" font-size="1.2" fill="currentColor" font-weight="bold">4</text>
                </svg>`
            };

            return icons[type] || `<svg viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12" rx="2" fill="currentColor"/></svg>`;
        }

        // Données des formats pour le rappel
        const formatData = {
            publication: { 
                name: 'Publication', 
                html: generateFormatIcon('publication')
            },
            carrousel: { 
                name: 'Carrousel', 
                html: generateFormatIcon('carrousel')
            },
            reel: { 
                name: 'Reel', 
                html: generateFormatIcon('reel')
            },
            story: { 
                name: 'Story', 
                html: generateFormatIcon('story')
            },
            video: { 
                name: 'Vidéo classique', 
                html: generateFormatIcon('video')
            },
            'multi-sequences': { 
                name: 'Multi-séquences', 
                html: generateFormatIcon('multi-sequences')
            },
            short: { 
                name: 'Short', 
                html: generateFormatIcon('short')
            },
            document: { 
                name: 'Document', 
                html: generateFormatIcon('document')
            },
            article: { 
                name: 'Article LinkedIn', 
                html: generateFormatIcon('article')
            },
            tweet: { 
                name: 'Tweet', 
                html: generateFormatIcon('tweet')
            },
            thread: { 
                name: 'Thread', 
                html: generateFormatIcon('thread')
            },
            epingle: { 
                name: 'Épingle', 
                html: generateFormatIcon('epingle')
            },
            'epingle-idee': { 
                name: 'Épingle Idée', 
                html: generateFormatIcon('epingle-idee')
            }
        };

        // Fonction pour mettre à jour le rappel des sélections
        function updateSelectionReminder(step) {
            const reminder = document.getElementById(`reminder-step-${step}`);
            if (!reminder) return;

            // Afficher le rappel si on a des sélections appropriées
            if ((step === 2 && selectedPlatform) || 
                (step >= 3 && selectedPlatform && selectedFormat)) {
                reminder.classList.add('show');
            }

            // Mettre à jour la plateforme
            if (selectedPlatform && step >= 2) {
                const platformIcon = document.getElementById(`reminder-platform-icon${step > 2 ? '-' + step : ''}`);
                const platformName = document.getElementById(`reminder-platform-name${step > 2 ? '-' + step : ''}`);
                
                if (platformIcon && platformName) {
                    platformIcon.className = `reminder-icon ${selectedPlatform}`;
                    platformIcon.innerHTML = platformData[selectedPlatform]?.html || '';
                    platformName.textContent = platformData[selectedPlatform]?.name || selectedPlatform;
                }
            }

            // Mettre à jour le format
            if (selectedFormat && step >= 3) {
                const formatIcon = document.getElementById(`reminder-format-icon-${step}`);
                const formatName = document.getElementById(`reminder-format-name-${step}`);
                
                if (formatIcon && formatName) {
                    formatIcon.className = `reminder-icon ${selectedFormat}`;
                    formatIcon.innerHTML = formatData[selectedFormat]?.html || '';
                    formatName.textContent = formatData[selectedFormat]?.name || selectedFormat;
                }
            }
        }

        // Ajouter le gestionnaire pour les rappels lors de la navigation
    </script>
</body>
</html>
